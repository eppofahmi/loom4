<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loom4 - AI Assistant</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* =================
       CSS VARIABLES
       ================= */
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --secondary-color: #6b7280;
      --success-color: #10b981;
      --danger-color: #ef4444;
      
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      
      --border-light: #e5e7eb;
      --border-medium: #d1d5db;
      
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      
      --spacing-1: 0.2rem;
      --spacing-2: 0.4rem;
      --spacing-3: 0.6rem;
      --spacing-4: 0.8rem;
      --spacing-6: 1.2rem;
      --spacing-8: 1.6rem;
      --spacing-12: 2.4rem;
      
      --transition: all 0.2s ease;
      --sidebar-width: 280px;
    }

    /* =================
       RESET & BASE
       ================= */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    /* =================
       LAYOUT
       ================= */
    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* =================
       CHAT STYLES
       ================= */
    .chat-history {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: var(--spacing-4) 0;
      overflow: hidden;
    }

    .chat-history-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-4);
      margin-bottom: var(--spacing-4);
    }

    .chat-history-header h3 {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin: 0;
    }

    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 0 var(--spacing-2);
    }

    .chat-item {
      padding: var(--spacing-3) var(--spacing-4);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-2);
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid transparent;
    }

    .chat-item:hover {
      background: var(--bg-tertiary);
    }

    .chat-item.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-hover);
    }

    .chat-title {
      font-weight: 500;
      font-size: 0.875rem;
      margin-bottom: var(--spacing-1);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chat-preview {
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.3;
      margin-bottom: var(--spacing-1);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .chat-item.active .chat-preview {
      color: rgba(255, 255, 255, 0.8);
    }

    .chat-time {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .chat-item.active .chat-time {
      color: rgba(255, 255, 255, 0.7);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: var(--spacing-4);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-4);
    }

    .message {
      display: flex;
      flex-direction: column;
      max-width: 80%;
    }

    .message.user {
      align-self: flex-end;
    }

    .message.assistant {
      align-self: flex-start;
    }

    .message-content {
      padding: var(--spacing-4);
      border-radius: var(--radius-lg);
      line-height: 1.6;
    }

    .message.user .message-content {
      background: var(--primary-color);
      color: white;
      border-bottom-right-radius: var(--spacing-2);
    }

    .message.assistant .message-content {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-bottom-left-radius: var(--spacing-2);
    }

    .message-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: var(--spacing-2);
      padding: 0 var(--spacing-2);
    }

    .artifact-preview {
      margin-top: var(--spacing-3);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      overflow: hidden;
      cursor: pointer;
      transition: var(--transition);
    }

    .artifact-preview:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-sm);
    }

    .artifact-preview-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      padding: var(--spacing-3);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-light);
    }

    .artifact-preview-title {
      flex: 1;
      font-weight: 500;
      font-size: 0.875rem;
    }

    .artifact-preview-type {
      font-size: 0.75rem;
      padding: var(--spacing-1) var(--spacing-2);
      background: var(--primary-color);
      color: white;
      border-radius: var(--radius-sm);
    }

    .artifact-preview-description {
      padding: var(--spacing-3);
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .artifact-preview-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-2) var(--spacing-3);
      background: var(--bg-secondary);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .welcome-message {
      text-align: center;
      padding: var(--spacing-12) var(--spacing-4);
      max-width: 600px;
      margin: 0 auto;
    }

    .welcome-message h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--spacing-4);
      color: var(--text-primary);
    }

    .welcome-message p {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-6);
      line-height: 1.6;
    }

    .welcome-actions {
      display: flex;
      justify-content: center;
      gap: var(--spacing-4);
    }

    /* Typing indicator */
    .typing-dots {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-muted);
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* =================
       SIDEBAR
       ================= */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-primary);
      border-right: 1px solid var(--border-light);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: var(--spacing-6);
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .app-logo h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0;
    }



    .sidebar-nav {
      flex: 1;
      padding: var(--spacing-4);
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-3) var(--spacing-4);
      margin-bottom: var(--spacing-2);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
    }

    .nav-item.active {
      background: var(--primary-color);
      color: white;
    }

    .nav-item i {
      width: 20px;
      text-align: center;
      font-size: 1.1rem;
    }

    .nav-item span {
      font-weight: 500;
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .nav-section-divider {
      margin: var(--spacing-4) var(--spacing-4) var(--spacing-3) var(--spacing-4);
      padding-top: var(--spacing-3);
      border-top: 1px solid var(--border-light);
    }

    .nav-section-divider span {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .chat-list-section {
      border-top: 1px solid var(--border-light);
      margin-top: var(--spacing-4);
      padding-top: var(--spacing-4);
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .chat-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-4);
      margin-bottom: var(--spacing-3);
      gap: var(--spacing-3);
    }

    .chat-list-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      flex: 1;
      text-align: center;
    }

    .chat-list-header .btn {
      padding: var(--spacing-2);
      min-width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .recent-chat-items {
      padding: 0 var(--spacing-4);
      max-height: 200px;
      overflow-y: auto;
    }

    .chat-items-container {
      flex: 1;
      overflow-y: auto;
      padding: 0 var(--spacing-4);
    }

    .chat-nav-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-3) var(--spacing-4);
      margin-bottom: var(--spacing-2);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
    }

    .chat-nav-item:hover {
      background: var(--bg-tertiary);
    }

    .chat-nav-item.active {
      background: var(--primary-color);
      color: white;
    }

    .chat-nav-item i {
      width: 20px;
      text-align: center;
      font-size: 1rem;
      flex-shrink: 0;
    }

    .chat-nav-item .chat-title {
      flex: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chat-nav-item .chat-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    /* Chat Table Styles */
    .chat-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .chat-table th {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-weight: 600;
      padding: var(--spacing-3) var(--spacing-4);
      text-align: left;
      border-bottom: 1px solid var(--border-light);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .chat-table-row {
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 1px solid var(--border-light);
    }

    .chat-table-row:hover {
      background: var(--bg-tertiary);
    }

    .chat-table-row.active {
      background: var(--primary-color);
      color: white;
    }

    .chat-table-row.active .chat-time-cell,
    .chat-table-row.active .chat-messages-cell {
      color: rgba(255, 255, 255, 0.8);
    }

    .chat-table td {
      padding: var(--spacing-3) var(--spacing-4);
      border-bottom: 1px solid var(--border-light);
    }

    .chat-title-cell {
      font-weight: 500;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chat-time-cell {
      color: var(--text-muted);
      font-size: 0.75rem;
      white-space: nowrap;
    }

    .chat-messages-cell {
      color: var(--text-muted);
      font-size: 0.75rem;
      text-align: center;
      min-width: 60px;
    }

    /* Chat List Panel Styles */
    .chat-list-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: var(--spacing-6);
    }

    .chat-list-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-6);
      padding-bottom: var(--spacing-4);
      border-bottom: 1px solid var(--border-light);
    }

    .chat-list-panel-header h2 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1.5rem;
      font-weight: 600;
    }

    .chat-list-controls {
      display: flex;
      gap: var(--spacing-3);
    }

    .chat-list-table-container {
      flex: 1;
      overflow-y: auto;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      background: var(--bg-primary);
    }

    /* Artifact Viewer Header */
    .artifact-viewer-header-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-4);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-secondary);
    }

    .artifact-viewer-header-info .artifact-info h3 {
      margin: 0 0 var(--spacing-1) 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .artifact-viewer-header-info .artifact-meta {
      display: flex;
      gap: var(--spacing-3);
      align-items: center;
    }

    .artifact-tabs-row {
      display: flex;
      border-bottom: 1px solid var(--border-light);
    }


    .sidebar-footer {
      margin-top: auto;
      padding-top: var(--spacing-3);
      border-top: 1px solid var(--border-light);
      position: relative;
    }

    .profile-menu-trigger {
      position: relative;
      justify-content: space-between;
    }

    .profile-chevron {
      font-size: 0.8rem;
      transition: transform 0.2s ease;
    }

    .profile-menu-trigger.active .profile-chevron {
      transform: rotate(180deg);
    }

    .profile-menu-overlay {
      position: absolute;
      bottom: 100%;
      left: 0;
      right: 0;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      margin-bottom: var(--spacing-2);
      padding: var(--spacing-2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: all 0.2s ease;
      z-index: 1000;
    }

    .profile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .profile-menu-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-3) var(--spacing-4);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
    }

    .profile-menu-item:hover {
      background: var(--bg-tertiary);
    }

    .profile-menu-item.logout {
      color: #ef4444;
    }

    .profile-menu-item.logout:hover {
      background: #fef2f2;
    }

    .profile-menu-item i {
      width: 16px;
      text-align: center;
      font-size: 1rem;
    }

    .profile-menu-divider {
      height: 1px;
      background: var(--border-light);
      margin: var(--spacing-2) 0;
    }


    /* =================
       CHAT PANEL
       ================= */
    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-light);
      min-width: 400px;
    }

    .chat-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .chat-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .chat-actions {
      display: flex;
      gap: var(--spacing-2);
    }

    /* =================
       PANEL RESIZER
       ================= */
    .panel-resizer {
      width: 4px;
      background: var(--border-light);
      cursor: col-resize;
      flex-shrink: 0;
      position: relative;
      z-index: 10;
      transition: background-color 0.2s ease;
    }

    .panel-resizer:hover {
      background: var(--primary-color);
    }

    .panel-resizer.dragging {
      background: var(--primary-color);
    }

    /* =================
       ARTIFACT PANEL
       ================= */
    .artifact-panel {
      width: 400px;
      min-width: 300px;
      max-width: 800px;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      transition: width 0.3s ease, margin-right 0.3s ease;
    }

    .artifact-panel.hidden {
      width: 0;
      margin-right: -4px;
      overflow: hidden;
    }

    .artifact-controls {
      display: flex;
      justify-content: flex-end;
      padding: var(--spacing-3);
      border-bottom: 1px solid var(--border-light);
    }

    .artifact-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .artifact-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .artifact-actions {
      display: flex;
      gap: var(--spacing-2);
    }

    .artifact-content {
      flex: 1;
      overflow: auto;
      padding: var(--spacing-4);
    }

    .artifact-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-3);
    }

    .artifact-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-4);
      cursor: pointer;
      transition: var(--transition);
    }

    .artifact-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-md);
    }

    .artifact-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-2);
    }

    .artifact-item-title {
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .artifact-item-type {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
    }

    .artifact-item-description {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: var(--spacing-2);
    }

    .artifact-item-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Artifact Viewer Styles */
    .artifact-info {
      flex: 1;
      min-width: 0;
    }

    .artifact-info h2 {
      margin: 0 0 var(--spacing-1) 0;
      font-size: 1.125rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .artifact-meta {
      display: flex;
      gap: var(--spacing-3);
      align-items: center;
    }

    .artifact-type-badge {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-sm);
      font-size: 0.625rem;
      font-weight: 500;
      text-transform: uppercase;
    }

    .artifact-size,
    .artifact-date {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .artifact-viewer-content {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .artifact-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-secondary);
      flex-shrink: 0;
    }

    .artifact-tab {
      padding: var(--spacing-3) var(--spacing-4);
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      transition: var(--transition);
      font-size: 0.875rem;
    }

    .artifact-tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      background: var(--bg-primary);
    }

    .artifact-tab:hover:not(.active) {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .artifact-viewer-body {
      flex: 1;
      overflow: auto;
      background: var(--bg-primary);
    }

    .artifact-tab-content {
      display: none;
      height: 100%;
    }

    .artifact-tab-content.active {
      display: block;
    }

    .artifact-code-viewer {
      height: 100%;
      padding: var(--spacing-4);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      background: var(--bg-secondary);
      color: var(--text-primary);
      white-space: pre-wrap;
      overflow: auto;
    }

    .artifact-preview-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }

    .empty-state {
      text-align: center;
      padding: var(--spacing-12) var(--spacing-6);
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 3rem;
      color: var(--text-muted);
      margin-bottom: var(--spacing-4);
    }

    .empty-state h3 {
      color: var(--text-primary);
      margin-bottom: var(--spacing-2);
      font-weight: 600;
    }

    .empty-state p {
      margin-bottom: var(--spacing-6);
      font-size: 0.875rem;
    }

    /* =================
       OTHER SECTIONS (LEGACY)
       ================= */
    .other-sections {
      position: absolute;
      top: 0;
      left: var(--sidebar-width);
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      z-index: 5;
      transition: left 0.3s ease;
    }


    /* Hide artifact panel and resizer when other sections are shown */
    .other-sections ~ .panel-resizer,
    .other-sections ~ .artifact-panel {
      display: none !important;
    }

    .content-section {
      display: none;
      flex-direction: column;
      height: 100%;
      overflow: auto;
    }

    .content-section.active {
      display: flex;
    }

    .section-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-6);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .section-header h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .section-content {
      flex: 1;
      padding: var(--spacing-6);
      overflow: auto;
    }

    /* =================
       BUTTONS
       ================= */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-2);
      padding: var(--spacing-3) var(--spacing-4);
      border: none;
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      font-size: 0.875rem;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--primary-hover);
    }

    .btn-secondary {
      background: var(--bg-primary);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-tertiary);
    }

    .btn-sm {
      padding: var(--spacing-2) var(--spacing-3);
      font-size: 0.75rem;
      border-radius: var(--radius-sm);
    }

    /* =================
       CARDS & GRIDS
       ================= */
    .grid {
      display: grid;
      gap: var(--spacing-6);
    }

    .grid-2 {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    .grid-3 {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    .card {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--spacing-6);
      transition: var(--transition);
      cursor: pointer;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
      border-color: var(--primary-color);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-4);
    }

    .card-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .card-badge {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
    }

    .card-description {
      color: var(--text-secondary);
      margin-bottom: var(--spacing-4);
    }

    .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    /* =================
       MODAL
       ================= */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: var(--spacing-4);
    }


    /* Modal Content Styles */
    .profile-picture-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-4);
    }

    .current-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .plan-info {
      background: var(--bg-secondary);
      padding: var(--spacing-4);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
    }

    .plan-badge {
      display: inline-block;
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: var(--spacing-2);
    }

    .plan-description {
      margin: var(--spacing-2) 0;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .settings-sections {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-6);
    }

    .settings-section h4 {
      color: var(--text-primary);
      font-size: 1.125rem;
      margin-bottom: var(--spacing-4);
      border-bottom: 1px solid var(--border-light);
      padding-bottom: var(--spacing-2);
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-2);
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      cursor: pointer;
      font-size: 0.875rem;
    }

    .help-sections, .learn-sections {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-6);
    }

    .help-section, .learn-section {
      padding: var(--spacing-4);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      background: var(--bg-secondary);
    }

    .help-section h4, .learn-section h4 {
      color: var(--text-primary);
      margin-bottom: var(--spacing-2);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .contact-options {
      display: flex;
      gap: var(--spacing-3);
      margin-top: var(--spacing-3);
    }

    .shortcuts-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-2);
      margin-top: var(--spacing-3);
    }

    .shortcut-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      font-size: 0.875rem;
    }

    .shortcut-item kbd {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      padding: var(--spacing-1) var(--spacing-2);
      font-size: 0.75rem;
      font-family: monospace;
    }

    .pricing-plans {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-6);
    }

    .plan-card {
      border: 2px solid var(--border-light);
      border-radius: var(--radius-xl);
      padding: var(--spacing-6);
      background: var(--bg-primary);
      position: relative;
      transition: var(--transition);
    }

    .plan-card.recommended {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-lg);
    }

    .plan-card.current-plan {
      border-color: var(--secondary-color);
      background: var(--bg-secondary);
    }

    .plan-header {
      text-align: center;
      margin-bottom: var(--spacing-4);
    }

    .plan-header h4 {
      font-size: 1.5rem;
      margin-bottom: var(--spacing-2);
    }

    .plan-price {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .plan-price span {
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 400;
    }

    .recommended-badge {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-3);
      border-radius: var(--radius-lg);
      font-size: 0.75rem;
      font-weight: 500;
    }

    .plan-features ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .plan-features li {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      margin-bottom: var(--spacing-2);
      font-size: 0.875rem;
    }

    .plan-features i {
      color: var(--success-color);
      font-size: 0.75rem;
    }

    .plan-footer {
      margin-top: var(--spacing-6);
      text-align: center;
    }

    .current-badge {
      background: var(--secondary-color);
      color: white;
      padding: var(--spacing-2) var(--spacing-4);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .use-cases {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-2);
      margin-top: var(--spacing-3);
    }

    .use-case-tag {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Notification Styles */
    .notification-container {
      position: fixed;
      top: var(--spacing-4);
      right: var(--spacing-4);
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-3);
      pointer-events: none;
    }

    .notification {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-4);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      max-width: 400px;
      min-width: 300px;
      pointer-events: auto;
      animation: slideInFromRight 0.3s ease-out;
    }

    .notification-success {
      border-left: 4px solid var(--success-color);
    }

    .notification-error {
      border-left: 4px solid var(--danger-color);
    }

    .notification-warning {
      border-left: 4px solid #f59e0b;
    }

    .notification-info {
      border-left: 4px solid var(--primary-color);
    }

    .notification-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notification-success .notification-icon {
      color: var(--success-color);
    }

    .notification-error .notification-icon {
      color: var(--danger-color);
    }

    .notification-warning .notification-icon {
      color: #f59e0b;
    }

    .notification-info .notification-icon {
      color: var(--primary-color);
    }

    .notification-content {
      flex: 1;
      font-size: 0.875rem;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .notification-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: var(--spacing-1);
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .notification-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    @keyframes slideInFromRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-primary);
      border-radius: var(--radius-xl);
      max-width: 90vw;
      max-height: 90vh;
      width: 600px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
    }

    .modal-header {
      padding: var(--spacing-6);
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      padding: var(--spacing-2);
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
    }

    .modal-body {
      flex: 1;
      padding: var(--spacing-6);
      overflow: auto;
    }

    .modal-footer {
      padding: var(--spacing-6);
      border-top: 1px solid var(--border-light);
      display: flex;
      gap: var(--spacing-3);
      justify-content: flex-end;
    }

    /* =================
       FORMS
       ================= */
    .form-group {
      margin-bottom: var(--spacing-4);
    }

    .form-label {
      display: block;
      margin-bottom: var(--spacing-2);
      font-weight: 500;
      color: var(--text-primary);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: var(--spacing-3);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* =================
       ARTIFACT VIEWER
       ================= */
    .artifact-viewer {
      background: var(--bg-primary);
    }

    .artifact-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: var(--spacing-4);
    }

    .tab-btn {
      padding: var(--spacing-3) var(--spacing-4);
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      transition: var(--transition);
    }

    .tab-btn.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .code-viewer {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--spacing-4);
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
    }

    .html-preview {
      width: 100%;
      height: 400px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
    }

    /* =================
       CHAT INTERFACE
       ================= */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .chat-messages {
      flex: 1;
      padding: var(--spacing-6);
      overflow-y: auto;
    }

    .welcome-message {
      text-align: center;
      padding: var(--spacing-12);
      color: var(--text-secondary);
    }

    .welcome-message h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--spacing-4);
      color: var(--text-primary);
    }

    .welcome-actions {
      display: flex;
      gap: var(--spacing-3);
      justify-content: center;
      margin-top: var(--spacing-6);
    }

    .chat-input-container {
      border-top: 1px solid var(--border-light);
      padding: var(--spacing-6);
      background: var(--bg-primary);
    }

    .chat-input {
      display: flex;
      gap: var(--spacing-3);
      align-items: flex-end;
    }

    .chat-input textarea {
      flex: 1;
      resize: none;
      min-height: 44px;
      max-height: 200px;
      padding: var(--spacing-3);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-lg);
    }

    .send-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    /* =================
       RESPONSIVE
       ================= */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        position: fixed;
        top: 0;
        left: -100%;
        z-index: 999;
        transition: var(--transition);
      }

      .sidebar.open {
        left: 0;
      }



      .chat-panel {
        min-width: unset;
      }

      .artifact-panel {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 90%;
        max-width: none;
        z-index: 998;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }

      .artifact-panel:not(.hidden) {
        transform: translateX(0);
      }

      .panel-resizer {
        display: none;
      }

      .other-sections {
        left: 0;
      }

      .grid-2,
      .grid-3 {
        grid-template-columns: 1fr;
      }

      .modal-content {
        width: 95vw;
        margin: var(--spacing-4);
      }

    }

    /* =================
       UTILITIES
       ================= */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mb-4 {
      margin-bottom: var(--spacing-4);
    }

    .mt-6 {
      margin-top: var(--spacing-6);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="app-logo">
          <h1>Loom4</h1>
        </div>
      </div>

      <!-- Sidebar Content Container -->
      <div class="sidebar-content">
        <nav class="sidebar-nav">
          <div class="nav-item active" data-section="chat">
            <i class="fas fa-comments"></i>
            <span>Chat List</span>
          </div>
          <div class="nav-item" data-section="projects">
            <i class="fas fa-folder"></i>
            <span>Projects</span>
          </div>
          <div class="nav-item" data-section="connect">
            <i class="fas fa-plug"></i>
            <span>Connect</span>
          </div>
          <div class="nav-item" data-section="artifacts">
            <i class="fas fa-cube"></i>
            <span>Artifacts</span>
          </div>

          <!-- Recent Chats Section (Always Visible) -->
          <div class="nav-section-divider">
            <span>Recent Chats</span>
          </div>
          <div class="recent-chat-items" id="recent-chat-list">
            <!-- Recent chat history will be rendered here as nav items -->
          </div>
        </nav>
      </div>

      <!-- Profile Section at Bottom -->
      <div class="sidebar-footer">
        <div class="nav-item profile-menu-trigger" id="profile-menu-trigger">
          <i class="fas fa-user"></i>
          <span>My Profile</span>
          <i class="fas fa-chevron-up profile-chevron"></i>
        </div>
        
        <!-- Profile Menu Overlay -->
        <div class="profile-menu-overlay" id="profile-menu-overlay">
          <div class="profile-menu-item" data-action="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </div>
          <div class="profile-menu-item" data-action="language">
            <i class="fas fa-globe"></i>
            <span>Language</span>
          </div>
          <div class="profile-menu-item" data-action="help">
            <i class="fas fa-question-circle"></i>
            <span>Get Help</span>
          </div>
          <div class="profile-menu-item" data-action="upgrade">
            <i class="fas fa-star"></i>
            <span>Upgrade Plan</span>
          </div>
          <div class="profile-menu-item" data-action="learn">
            <i class="fas fa-book"></i>
            <span>Learn More</span>
          </div>
          <div class="profile-menu-divider"></div>
          <div class="profile-menu-item logout" data-action="logout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Log Out</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Chat Panel -->
    <div class="chat-panel" id="chat-panel">
      
      <div class="chat-messages" id="chat-messages">
        <div class="welcome-message">
          <h1>Hello, I'm Loom4</h1>
          <p>I'm an AI assistant that can help you with analysis, writing, coding, math, and many other tasks.</p>
          <div class="welcome-actions">
            <button class="btn btn-primary" onclick="document.getElementById('chat-input').focus()">
              <i class="fas fa-comment"></i>
              Start Chatting
            </button>
          </div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="chat-input">
          <textarea id="chat-input" placeholder="How can I help you today?"></textarea>
          <button class="btn btn-secondary" id="show-artifact-btn" title="Show Artifact Panel">
            <i class="fas fa-cube"></i>
          </button>
          <button class="btn btn-primary send-btn" id="send-btn" disabled>
            <i class="fas fa-arrow-up"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Resizer -->
    <div class="panel-resizer" id="panel-resizer"></div>

    <!-- Artifact Panel -->
    <div class="artifact-panel" id="artifact-panel">
      <div class="artifact-controls">
        <button class="btn btn-ghost" id="close-artifact-btn" title="Close Artifact Panel">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="artifact-content">
        <!-- Default content: Artifact list -->
        <div class="artifact-default-content" id="artifact-default-content">
          <div class="artifact-list" id="artifact-list">
            <!-- Artifacts will be rendered here -->
          </div>
          <div class="empty-state" id="artifact-empty-state" style="display: none;">
            <div class="empty-state-icon">
              <i class="fas fa-cube"></i>
            </div>
            <h3>No artifacts yet</h3>
            <p>Create your first artifact to get started</p>
            <button class="btn btn-primary" onclick="Loom4.showCreateArtifact()">
              <i class="fas fa-plus"></i>
              Create Artifact
            </button>
          </div>
        </div>
        
        <!-- Artifact viewer content -->
        <div class="artifact-viewer-content" id="artifact-viewer-content" style="display: none;">
          <div class="artifact-tabs" id="artifact-viewer-tabs">
            <!-- Tabs will be generated based on artifact type -->
          </div>
          <div class="artifact-viewer-body" id="artifact-viewer-body">
            <!-- Content will be rendered here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Other Sections (Hidden by default) -->
    <div class="other-sections" id="other-sections" style="display: none;">
      <!-- Projects Section -->
      <div class="content-section" id="projects-section">
        <div class="section-header">
          <h2>Projects</h2>
          <button class="btn btn-primary" id="add-project-btn">
            <i class="fas fa-plus"></i>
            Add Project
          </button>
        </div>
        <div class="section-content">
          <div class="grid grid-2" id="projects-grid">
            <!-- Projects will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Connect Section -->
      <div class="content-section" id="connect-section">
        <div class="section-header">
          <h2>Knowledge Base</h2>
        </div>
        <div class="section-content">
          <p class="text-center mb-4">Connect your data sources to enhance AI conversations</p>
          <div class="grid grid-2">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Files</div>
                <i class="fas fa-file-upload" style="color: var(--primary-color);"></i>
              </div>
              <div class="card-description">Upload documents, PDFs, and other files</div>
              <button class="btn btn-primary">Connect Files</button>
            </div>
            <div class="card">
              <div class="card-header">
                <div class="card-title">Web Content</div>
                <i class="fas fa-globe" style="color: var(--success-color);"></i>
              </div>
              <div class="card-description">Connect to websites and online resources</div>
              <button class="btn btn-primary">Connect Website</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Artifacts Grid Section -->
      <div class="content-section" id="artifacts-section">
        <div class="section-header">
          <h2>Your Artifacts</h2>
          <button class="btn btn-primary" id="create-artifact-btn-alt">
            <i class="fas fa-plus"></i>
            Create Artifact
          </button>
        </div>
        <div class="section-content">
          <div class="grid grid-3" id="artifacts-grid">
            <!-- Artifacts will be rendered here -->
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Modals -->
  
  <!-- Personal Settings Modal -->
  <div class="modal" id="personal-settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Personal Settings</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="profile-settings">
          <div class="form-group">
            <label class="form-label">Profile Picture</label>
            <div class="profile-picture-section">
              <div class="current-avatar">
                <i class="fas fa-user"></i>
              </div>
              <button class="btn btn-secondary">Change Avatar</button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="user-name">Full Name</label>
            <input type="text" id="user-name" class="form-input" value="John Doe">
          </div>
          <div class="form-group">
            <label class="form-label" for="user-email">Email</label>
            <input type="email" id="user-email" class="form-input" value="john.doe@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">Current Plan</label>
            <div class="plan-info">
              <div class="plan-badge">Free Plan</div>
              <p class="plan-description">You're on the free plan with basic features.</p>
              <button class="btn btn-primary" onclick="Loom4.handleProfileAction('upgrade')">Upgrade to Pro</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="save-profile-btn">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Application Settings</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-sections">
          <div class="settings-section">
            <h4>Appearance</h4>
            <div class="form-group">
              <label class="form-label">Theme</label>
              <select id="theme-select" class="form-select">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="auto">Auto (System)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Sidebar</label>
              <div class="checkbox-group">
                <label><input type="checkbox" id="auto-collapse-sidebar"> Auto-collapse sidebar</label>
              </div>
            </div>
          </div>
          <div class="settings-section">
            <h4>Notifications</h4>
            <div class="checkbox-group">
              <label><input type="checkbox" id="email-notifications" checked> Email notifications</label>
              <label><input type="checkbox" id="push-notifications" checked> Push notifications</label>
              <label><input type="checkbox" id="sound-notifications"> Sound notifications</label>
            </div>
          </div>
          <div class="settings-section">
            <h4>Privacy</h4>
            <div class="checkbox-group">
              <label><input type="checkbox" id="analytics-opt-out"> Opt out of analytics</label>
              <label><input type="checkbox" id="crash-reports" checked> Send crash reports</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="save-settings-btn">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Language Modal -->
  <div class="modal" id="language-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Language Settings</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="language-options">
          <div class="form-group">
            <label class="form-label">Interface Language</label>
            <select id="language-select" class="form-select">
              <option value="en" selected>English</option>
              <option value="es">Español</option>
              <option value="fr">Français</option>
              <option value="de">Deutsch</option>
              <option value="it">Italiano</option>
              <option value="pt">Português</option>
              <option value="ja">日本語</option>
              <option value="ko">한국어</option>
              <option value="zh">中文</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Region</label>
            <select id="region-select" class="form-select">
              <option value="us" selected>United States</option>
              <option value="uk">United Kingdom</option>
              <option value="ca">Canada</option>
              <option value="au">Australia</option>
              <option value="eu">Europe</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Date Format</label>
            <select id="date-format-select" class="form-select">
              <option value="mdy" selected>MM/DD/YYYY</option>
              <option value="dmy">DD/MM/YYYY</option>
              <option value="ymd">YYYY-MM-DD</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="save-language-btn">Apply Changes</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="help-modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">Help & Support</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="help-sections">
          <div class="help-section">
            <h4><i class="fas fa-book"></i> Documentation</h4>
            <p>Learn how to use Loom4 effectively with our comprehensive guides.</p>
            <button class="btn btn-primary">View Documentation</button>
          </div>
          <div class="help-section">
            <h4><i class="fas fa-video"></i> Video Tutorials</h4>
            <p>Watch step-by-step video tutorials to master Loom4 features.</p>
            <button class="btn btn-primary">Watch Tutorials</button>
          </div>
          <div class="help-section">
            <h4><i class="fas fa-comments"></i> Community Forum</h4>
            <p>Connect with other users and get help from the community.</p>
            <button class="btn btn-primary">Join Forum</button>
          </div>
          <div class="help-section">
            <h4><i class="fas fa-envelope"></i> Contact Support</h4>
            <p>Get direct help from our support team.</p>
            <div class="contact-options">
              <button class="btn btn-secondary">Email Support</button>
              <button class="btn btn-secondary">Live Chat</button>
            </div>
          </div>
          <div class="help-section">
            <h4><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h4>
            <div class="shortcuts-list">
              <div class="shortcut-item">
                <kbd>Ctrl</kbd> + <kbd>N</kbd> <span>New Project</span>
              </div>
              <div class="shortcut-item">
                <kbd>Ctrl</kbd> + <kbd>K</kbd> <span>Quick Search</span>
              </div>
              <div class="shortcut-item">
                <kbd>Ctrl</kbd> + <kbd>/</kbd> <span>Toggle Sidebar</span>
              </div>
              <div class="shortcut-item">
                <kbd>Esc</kbd> <span>Close Modal</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upgrade Plan Modal -->
  <div class="modal" id="upgrade-modal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3 class="modal-title">Upgrade Your Plan</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="pricing-plans">
          <div class="plan-card current-plan">
            <div class="plan-header">
              <h4>Free</h4>
              <div class="plan-price">$0<span>/month</span></div>
            </div>
            <div class="plan-features">
              <ul>
                <li><i class="fas fa-check"></i> 5 Projects</li>
                <li><i class="fas fa-check"></i> Basic AI Features</li>
                <li><i class="fas fa-check"></i> 1GB Storage</li>
                <li><i class="fas fa-check"></i> Community Support</li>
              </ul>
            </div>
            <div class="plan-footer">
              <span class="current-badge">Current Plan</span>
            </div>
          </div>
          <div class="plan-card recommended">
            <div class="plan-header">
              <h4>Pro</h4>
              <div class="plan-price">$19<span>/month</span></div>
              <div class="recommended-badge">Recommended</div>
            </div>
            <div class="plan-features">
              <ul>
                <li><i class="fas fa-check"></i> Unlimited Projects</li>
                <li><i class="fas fa-check"></i> Advanced AI Features</li>
                <li><i class="fas fa-check"></i> 100GB Storage</li>
                <li><i class="fas fa-check"></i> Priority Support</li>
                <li><i class="fas fa-check"></i> Team Collaboration</li>
                <li><i class="fas fa-check"></i> Custom Integrations</li>
              </ul>
            </div>
            <div class="plan-footer">
              <button class="btn btn-primary">Upgrade to Pro</button>
            </div>
          </div>
          <div class="plan-card">
            <div class="plan-header">
              <h4>Enterprise</h4>
              <div class="plan-price">$99<span>/month</span></div>
            </div>
            <div class="plan-features">
              <ul>
                <li><i class="fas fa-check"></i> Everything in Pro</li>
                <li><i class="fas fa-check"></i> Unlimited Storage</li>
                <li><i class="fas fa-check"></i> Advanced Security</li>
                <li><i class="fas fa-check"></i> Dedicated Support</li>
                <li><i class="fas fa-check"></i> Custom Deployment</li>
                <li><i class="fas fa-check"></i> SLA Guarantee</li>
              </ul>
            </div>
            <div class="plan-footer">
              <button class="btn btn-secondary">Contact Sales</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Learn More Modal -->
  <div class="modal" id="learn-modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">Learn More About Loom4</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="learn-sections">
          <div class="learn-section">
            <h4>🚀 Getting Started</h4>
            <p>New to Loom4? Start here to learn the basics and set up your first project.</p>
            <button class="btn btn-primary">Start Tutorial</button>
          </div>
          <div class="learn-section">
            <h4>🤖 AI Features</h4>
            <p>Discover how to leverage AI to boost your productivity and creativity.</p>
            <button class="btn btn-primary">Explore AI Features</button>
          </div>
          <div class="learn-section">
            <h4>🛠️ Advanced Workflows</h4>
            <p>Learn advanced techniques and workflows for power users.</p>
            <button class="btn btn-primary">View Advanced Guides</button>
          </div>
          <div class="learn-section">
            <h4>🔗 Integrations</h4>
            <p>Connect Loom4 with your favorite tools and services.</p>
            <button class="btn btn-primary">Browse Integrations</button>
          </div>
          <div class="learn-section">
            <h4>📊 Use Cases</h4>
            <p>See real-world examples of how others use Loom4.</p>
            <div class="use-cases">
              <span class="use-case-tag">Web Development</span>
              <span class="use-case-tag">Content Creation</span>
              <span class="use-case-tag">Data Analysis</span>
              <span class="use-case-tag">Design</span>
              <span class="use-case-tag">Education</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Artifact Modal -->
  <div class="modal" id="create-artifact-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Artifact</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="create-artifact-form">
          <div class="form-group">
            <label class="form-label" for="artifact-title">Title *</label>
            <input type="text" id="artifact-title" class="form-input" required placeholder="Enter artifact title">
          </div>
          <div class="form-group">
            <label class="form-label" for="artifact-type">Type *</label>
            <select id="artifact-type" class="form-select" required>
              <option value="">Select type</option>
              <option value="html">HTML</option>
              <option value="css">CSS</option>
              <option value="javascript">JavaScript</option>
              <option value="markdown">Markdown</option>
              <option value="text">Plain Text</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="artifact-content">Content *</label>
            <textarea id="artifact-content" class="form-textarea" required rows="8" placeholder="Enter artifact content"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label" for="artifact-preview">Preview Description</label>
            <textarea id="artifact-preview" class="form-textarea" rows="3" placeholder="Brief description of the artifact"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary modal-close">Cancel</button>
        <button class="btn btn-primary" id="save-artifact-btn">Create Artifact</button>
      </div>
    </div>
  </div>

  <!-- Artifact Viewer Modal -->
  <div class="modal" id="artifact-viewer-modal">
    <div class="modal-content" style="max-width: 90vw; width: 900px;">
      <div class="modal-header">
        <div>
          <h3 class="modal-title" id="artifact-viewer-title">Artifact Title</h3>
          <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 4px;" id="artifact-viewer-meta">Type • Size</div>
        </div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body artifact-viewer">
        <div class="artifact-tabs" id="artifact-tabs">
          <!-- Tabs will be generated based on artifact type -->
        </div>
        <div id="artifact-content">
          <!-- Content will be rendered here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // LOOM4 APPLICATION CORE
    // ==========================================
    class Loom4App {
      constructor() {
        this.currentSection = 'chat';
        this.data = {
          projects: [],
          artifacts: [],
          chats: []
        };
        this.panelSizes = {
          artifactPanel: 400
        };
        this.isResizing = false;
        this.currentArtifact = null;
        this.sidebarMinimized = false;
        
        this.init();
      }

      // Initialize the application
      init() {
        this.loadSampleData();
        this.loadUserSettings();
        this.loadPanelSettings();
        this.setupEventListeners();
        this.render();
        
        // Load first chat by default
        if (this.data.chats.length > 0) {
          this.currentChatId = this.data.chats[0].id;
          this.renderChatHistory();
          this.renderCurrentChat();
        }
        
        console.log('Loom4 Application initialized');
      }

      // Load user settings from localStorage
      loadUserSettings() {
        // Load user profile
        const profile = localStorage.getItem('loom4_user_profile');
        if (profile) {
          const userData = JSON.parse(profile);
          document.getElementById('user-name').value = userData.name;
          document.getElementById('user-email').value = userData.email;
        }

        // Load application settings
        const settings = localStorage.getItem('loom4_settings');
        if (settings) {
          const settingsData = JSON.parse(settings);
          
          // Apply theme
          if (settingsData.theme && settingsData.theme !== 'auto') {
            document.body.setAttribute('data-theme', settingsData.theme);
          }
          
          // Set form values
          if (document.getElementById('theme-select')) {
            document.getElementById('theme-select').value = settingsData.theme || 'light';
            document.getElementById('auto-collapse-sidebar').checked = settingsData.autoCollapse || false;
            document.getElementById('email-notifications').checked = settingsData.notifications?.email !== false;
            document.getElementById('push-notifications').checked = settingsData.notifications?.push !== false;
            document.getElementById('sound-notifications').checked = settingsData.notifications?.sound || false;
            document.getElementById('analytics-opt-out').checked = settingsData.privacy?.analyticsOptOut || false;
            document.getElementById('crash-reports').checked = settingsData.privacy?.crashReports !== false;
          }
        }

        // Load language settings
        const language = localStorage.getItem('loom4_language');
        if (language) {
          const languageData = JSON.parse(language);
          if (document.getElementById('language-select')) {
            document.getElementById('language-select').value = languageData.language || 'en';
            document.getElementById('region-select').value = languageData.region || 'us';
            document.getElementById('date-format-select').value = languageData.dateFormat || 'mdy';
          }
        }
      }

      // Setup all event listeners
      setupEventListeners() {
        // Navigation
        document.querySelectorAll('.nav-item[data-section]').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const section = item.dataset.section;
            this.showSection(section);
          });
        });

        // Buttons
        document.getElementById('add-project-btn')?.addEventListener('click', () => this.showCreateProject());
        document.getElementById('create-artifact-btn')?.addEventListener('click', () => this.showCreateArtifact());
        document.getElementById('new-chat-btn')?.addEventListener('click', () => this.showNewChat());
        document.getElementById('new-chat-btn-header')?.addEventListener('click', () => this.showNewChat());
        document.getElementById('search-chat-btn')?.addEventListener('click', () => this.showChatSearch());
        document.getElementById('send-btn')?.addEventListener('click', () => this.sendMessage());
        document.getElementById('save-artifact-btn')?.addEventListener('click', () => this.saveArtifact());
        
        
        // Modal save buttons
        document.getElementById('save-settings-btn')?.addEventListener('click', () => this.saveSettings());
        document.getElementById('save-language-btn')?.addEventListener('click', () => this.saveLanguage());
        
        // Sidebar toggle
        
        // Profile menu
        document.getElementById('profile-menu-trigger')?.addEventListener('click', () => this.toggleProfileMenu());
        
        // Profile menu items
        document.querySelectorAll('.profile-menu-item').forEach(item => {
          item.addEventListener('click', (e) => {
            const action = e.currentTarget.dataset.action;
            this.handleProfileMenuAction(action);
          });
        });
        
        // Close profile menu when clicking outside
        document.addEventListener('click', (e) => {
          const profileTrigger = document.getElementById('profile-menu-trigger');
          const profileOverlay = document.getElementById('profile-menu-overlay');
          if (!profileTrigger?.contains(e.target) && !profileOverlay?.contains(e.target)) {
            this.closeProfileMenu();
          }
        });
        
        // Panel controls
        document.getElementById('show-artifact-btn')?.addEventListener('click', () => this.showArtifactPanel());
        document.getElementById('close-artifact-btn')?.addEventListener('click', () => this.hideArtifactPanel());
        document.getElementById('close-artifact-btn-viewer')?.addEventListener('click', () => this.hideArtifactPanel());
        document.getElementById('back-to-list-btn')?.addEventListener('click', () => this.showArtifactList());
        document.getElementById('edit-artifact-btn')?.addEventListener('click', () => this.editCurrentArtifact());
        
        // Panel resizer
        this.setupPanelResizer();

        // Modal close buttons
        document.querySelectorAll('.modal-close').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal');
            this.closeModal(modal);
          });
        });

        // Modal backdrop clicks
        document.querySelectorAll('.modal').forEach(modal => {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              this.closeModal(modal);
            }
          });
        });


        // Chat input
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        if (chatInput && sendBtn) {
          chatInput.addEventListener('input', () => {
            sendBtn.disabled = !chatInput.value.trim();
          });
          chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              this.sendMessage();
            }
          });
        }
      }

      // Show a specific section
      showSection(sectionName) {
        // Update navigation
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });
        document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');

        const otherSections = document.getElementById('other-sections');
        const chatPanel = document.getElementById('chat-panel');
        const artifactPanel = document.getElementById('artifact-panel');
        const panelResizer = document.getElementById('panel-resizer');

        if (sectionName === 'chat') {
          // Show chat panel layout with artifact panel
          otherSections.style.display = 'none';
          chatPanel.style.display = 'flex';
          
          // Restore artifact panel visibility based on saved state
          const artifactPanelVisible = localStorage.getItem('loom4_artifact_panel_visible');
          if (artifactPanelVisible !== 'false') {
            artifactPanel.style.display = 'flex';
            panelResizer.style.display = 'block';
          }
          
          // Show chat list table in main panel
          this.showChatListInPanel();
          
          this.currentSection = sectionName;
        } else {
          // Show other sections, hide chat panels
          otherSections.style.display = 'block';
          chatPanel.style.display = 'none';
          artifactPanel.style.display = 'none';
          panelResizer.style.display = 'none';
          
          // Update content within other sections
          document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
          });
          document.getElementById(`${sectionName}-section`)?.classList.add('active');
          
          this.currentSection = sectionName;
        }
        
        console.log(`Switched to ${sectionName} section`);
      }

      // Show chat section without triggering chat list view (for artifact linking)
      showChatSection() {
        // Update navigation
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });
        document.querySelector('[data-section="chat"]')?.classList.add('active');

        const otherSections = document.getElementById('other-sections');
        const chatPanel = document.getElementById('chat-panel');
        const artifactPanel = document.getElementById('artifact-panel');
        const panelResizer = document.getElementById('panel-resizer');

        // Show chat panel layout with artifact panel
        otherSections.style.display = 'none';
        chatPanel.style.display = 'flex';
        
        // Restore artifact panel visibility
        const artifactPanelVisible = localStorage.getItem('loom4_artifact_panel_visible');
        if (artifactPanelVisible !== 'false') {
          artifactPanel.style.display = 'flex';
          panelResizer.style.display = 'block';
        }
        
        this.currentSection = 'chat';
      }

      // Show chat list table in main chat panel
      showChatListInPanel() {
        const chatMessages = document.getElementById('chat-messages');
        if (!chatMessages) return;

        // Create chat list interface in main panel
        chatMessages.innerHTML = `
          <div class="chat-list-panel">
            <div class="chat-list-panel-header">
              <h2>All Conversations</h2>
              <div class="chat-list-controls">
                <button class="btn btn-secondary" id="search-chat-btn" title="Search Chats">
                  <i class="fas fa-search"></i>
                  Search
                </button>
                <button class="btn btn-primary" id="new-chat-btn-panel" title="New Chat">
                  <i class="fas fa-plus"></i>
                  New Chat
                </button>
              </div>
            </div>
            <div class="chat-list-table-container" id="chat-list-table-container">
              <!-- Chat table will be rendered here -->
            </div>
          </div>
        `;

        // Render the chat table
        this.renderChatTable();
        
        // Add event listeners for new buttons
        document.getElementById('search-chat-btn')?.addEventListener('click', () => this.showChatSearch());
        document.getElementById('new-chat-btn-panel')?.addEventListener('click', () => this.showNewChat());
      }

      // Render chat table in the panel
      renderChatTable() {
        const container = document.getElementById('chat-list-table-container');
        if (!container) return;

        if (this.data.chats.length === 0) {
          container.innerHTML = '<div class="empty-state">No conversations yet</div>';
          return;
        }

        container.innerHTML = `
          <table class="chat-table">
            <thead>
              <tr>
                <th>Chat Title</th>
                <th>Last Updated</th>
                <th>Messages</th>
              </tr>
            </thead>
            <tbody>
              ${this.data.chats.map(chat => `
                <tr class="chat-table-row ${this.currentChatId === chat.id ? 'active' : ''}" onclick="Loom4.loadChat(${chat.id})">
                  <td class="chat-title-cell">${chat.title}</td>
                  <td class="chat-time-cell">${this.formatDate(chat.updatedAt)}</td>
                  <td class="chat-messages-cell">${chat.messages.length}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      }

      showChatSearch() {
        // TODO: Implement chat search functionality
        console.log('Chat search clicked');
        alert('Chat search functionality will be implemented here');
      }

      // Load sample data
      loadSampleData() {
        // Sample chat conversations
        this.data.chats = [
          {
            id: 1,
            title: "Create Landing Page",
            messages: [
              {
                id: 1,
                role: "user",
                content: "Help me create a modern landing page for a tech startup",
                timestamp: new Date(Date.now() - 3600000).toISOString()
              },
              {
                id: 2,
                role: "assistant",
                content: "I'll help you create a modern landing page for your tech startup. Let me build a responsive design with a hero section, features, and call-to-action.",
                timestamp: new Date(Date.now() - 3580000).toISOString(),
                hasArtifact: true,
                artifactId: 1
              }
            ],
            createdAt: new Date(Date.now() - 3600000).toISOString(),
            updatedAt: new Date(Date.now() - 3580000).toISOString()
          },
          {
            id: 2,
            title: "CSS Grid Tutorial",
            messages: [
              {
                id: 1,
                role: "user",
                content: "Can you show me how to create a responsive grid layout with CSS?",
                timestamp: new Date(Date.now() - 7200000).toISOString()
              },
              {
                id: 2,
                role: "assistant",
                content: "Absolutely! I'll create a responsive CSS Grid layout that adapts to different screen sizes. This layout uses auto-fit and minmax for perfect responsiveness.",
                timestamp: new Date(Date.now() - 7180000).toISOString(),
                hasArtifact: true,
                artifactId: 2
              }
            ],
            createdAt: new Date(Date.now() - 7200000).toISOString(),
            updatedAt: new Date(Date.now() - 7180000).toISOString()
          },
          {
            id: 3,
            title: "React Dashboard Component",
            messages: [
              {
                id: 1,
                role: "user",
                content: "I need a React component for a user dashboard with loading states",
                timestamp: new Date(Date.now() - 10800000).toISOString()
              },
              {
                id: 2,
                role: "assistant",
                content: "I'll create a comprehensive React dashboard component with proper loading states, error handling, and user data display. This follows React best practices with hooks.",
                timestamp: new Date(Date.now() - 10780000).toISOString(),
                hasArtifact: true,
                artifactId: 3
              }
            ],
            createdAt: new Date(Date.now() - 10800000).toISOString(),
            updatedAt: new Date(Date.now() - 10780000).toISOString()
          }
        ];

        // Sample Projects
        this.data.projects = [
          {
            id: 1,
            title: "Website Redesign",
            description: "Complete redesign of company website with modern UI/UX",
            status: "Active",
            lastActive: "2024-01-15",
            createdAt: new Date().toISOString()
          },
          {
            id: 2,
            title: "Mobile App Development",
            description: "Building a cross-platform mobile app for iOS and Android",
            status: "Active",
            lastActive: "2024-01-12",
            createdAt: new Date().toISOString()
          },
          {
            id: 3,
            title: "Marketing Campaign",
            description: "Q3 marketing campaign for new product launch",
            status: "Planned",
            lastActive: "",
            createdAt: new Date().toISOString()
          }
        ];

        // Sample Artifacts
        this.data.artifacts = [
          {
            id: 1,
            title: "Homepage HTML",
            type: "html",
            content: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beautiful Homepage</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 80px 20px;
            text-align: center;
        }
        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 60px;
            border-radius: 20px;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3rem;
            margin: 0 0 20px 0;
            font-weight: 700;
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .cta {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .cta:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to the Future</h1>
            <p>Experience the next generation of web design</p>
        </div>
        <button class="cta">Get Started Today</button>
    </div>
</body>
</html>`,
            preview: "Modern homepage with gradient design and glass morphism effects",
            createdAt: new Date().toISOString(),
            size: "2.1 KB"
          },
          {
            id: 2,
            title: "CSS Grid Layout",
            type: "css",
            content: `.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.grid-item {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 1px solid #e5e7eb;
}

.grid-item:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: #3b82f6;
}

.grid-item h3 {
  color: #1f2937;
  font-size: 1.5rem;
  margin-bottom: 16px;
  font-weight: 600;
}

.grid-item p {
  color: #6b7280;
  line-height: 1.6;
  margin: 0;
}

@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: 1fr;
    padding: 16px;
    gap: 16px;
  }
  
  .grid-item {
    padding: 20px;
  }
}`,
            preview: "Responsive CSS grid layout with hover effects and mobile optimization",
            createdAt: new Date(Date.now() - 3600000).toISOString(),
            size: "1.2 KB"
          },
          {
            id: 3,
            title: "React Component",
            type: "javascript",
            content: `import React, { useState, useEffect } from 'react';

const UserDashboard = ({ userId }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUser = async () => {
      try {
        setLoading(true);
        const response = await fetch(\`/api/users/\${userId}\`);
        
        if (!response.ok) {
          throw new Error('Failed to fetch user data');
        }
        
        const userData = await response.json();
        setUser(userData);
      } catch (err) {
        setError(err.message);
        console.error('Error fetching user:', err);
      } finally {
        setLoading(false);
      }
    };

    if (userId) {
      fetchUser();
    }
  }, [userId]);

  if (loading) {
    return (
      <div className="loading-spinner">
        <div className="spinner"></div>
        <p>Loading user data...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="error-message">
        <h3>Oops! Something went wrong</h3>
        <p>{error}</p>
        <button onClick={() => window.location.reload()}>
          Try Again
        </button>
      </div>
    );
  }

  if (!user) {
    return (
      <div className="no-data">
        <h3>No user data found</h3>
        <p>Please check your connection and try again.</p>
      </div>
    );
  }

  return (
    <div className="user-dashboard">
      <header className="dashboard-header">
        <div className="user-info">
          <img 
            src={user.avatar || '/default-avatar.png'} 
            alt={user.name}
            className="user-avatar"
          />
          <div>
            <h1>Welcome back, {user.name}!</h1>
            <p className="user-email">{user.email}</p>
          </div>
        </div>
      </header>
      
      <div className="dashboard-content">
        <div className="stats-grid">
          <div className="stat-card">
            <h3>Projects</h3>
            <p className="stat-number">{user.projectCount || 0}</p>
          </div>
          <div className="stat-card">
            <h3>Tasks Completed</h3>
            <p className="stat-number">{user.taskCount || 0}</p>
          </div>
          <div className="stat-card">
            <h3>Time Saved</h3>
            <p className="stat-number">{user.timeSaved || '0h'}</p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default UserDashboard;`,
            preview: "React dashboard component with loading states, error handling, and user stats",
            createdAt: new Date(Date.now() - 7200000).toISOString(),
            size: "3.1 KB"
          }
        ];

        console.log('Sample data loaded');
      }

      // Render all components
      render() {
        this.renderProjects();
        this.renderArtifacts();
        this.renderArtifactList();
        this.renderChatHistory();
        this.renderCurrentChat();
      }

      // Render projects grid
      renderProjects() {
        const grid = document.getElementById('projects-grid');
        if (!grid) return;

        grid.innerHTML = this.data.projects.map(project => `
          <div class="card" onclick="Loom4.viewProject(${project.id})">
            <div class="card-header">
              <div class="card-title">${project.title}</div>
              <div class="card-badge">${project.status}</div>
            </div>
            <div class="card-description">${project.description}</div>
            <div class="card-meta">
              <span>${project.lastActive ? `Last active: ${project.lastActive}` : 'Not started'}</span>
              <span><i class="fas fa-folder"></i></span>
            </div>
          </div>
        `).join('');
      }

      // Render artifacts grid
      renderArtifacts() {
        const grid = document.getElementById('artifacts-grid');
        if (!grid) return;

        grid.innerHTML = this.data.artifacts.map(artifact => `
          <div class="card" onclick="Loom4.viewArtifact(${artifact.id})">
            <div class="card-header">
              <div class="card-title">${artifact.title}</div>
              <div class="card-badge">${artifact.type.toUpperCase()}</div>
            </div>
            <div class="card-description">${artifact.preview}</div>
            <div class="card-meta">
              <span>${this.formatDate(artifact.createdAt)}</span>
              <span>${artifact.size}</span>
            </div>
          </div>
        `).join('');
      }

      // View project
      viewProject(id) {
        const project = this.data.projects.find(p => p.id === id);
        if (project) {
          alert(`Project: ${project.title}\n\n${project.description}\n\nStatus: ${project.status}\n\nIn the full version, this would open the project workspace with AI tools and collaboration features.`);
        }
      }

      // Render recent chats in sidebar
      renderChatHistory() {
        this.renderRecentChats();
      }

      // Render recent chats in sidebar (limited to 5)
      renderRecentChats() {
        const recentChatList = document.getElementById('recent-chat-list');
        if (!recentChatList) return;

        if (this.data.chats.length === 0) {
          recentChatList.innerHTML = '<div class="empty-state">No conversations yet</div>';
          return;
        }

        // Show only the 5 most recent chats
        const recentChats = this.data.chats.slice(0, 5);
        recentChatList.innerHTML = recentChats.map(chat => `
          <div class="chat-nav-item ${this.currentChatId === chat.id ? 'active' : ''}" onclick="Loom4.loadChat(${chat.id})">
            <i class="fas fa-message"></i>
            <div class="chat-title">${chat.title}</div>
            <div class="chat-time">${this.formatDate(chat.updatedAt)}</div>
          </div>
        `).join('');
      }


      // Get last message from chat
      getLastMessage(chat) {
        const lastMessage = chat.messages[chat.messages.length - 1];
        if (lastMessage.content.length > 50) {
          return lastMessage.content.substring(0, 50) + '...';
        }
        return lastMessage.content;
      }

      // Load specific chat
      loadChat(chatId) {
        this.currentChatId = chatId;
        this.renderChatHistory();
        this.renderCurrentChat();
        
        // Show chat section if not already there
        if (this.currentSection !== 'chat') {
          this.showSection('chat');
        }
      }

      // Render current chat messages
      renderCurrentChat() {
        const messagesContainer = document.getElementById('chat-messages');
        if (!messagesContainer) return;

        const currentChat = this.data.chats.find(chat => chat.id === this.currentChatId);
        if (!currentChat) {
          messagesContainer.innerHTML = '<div class="welcome-message">Select a conversation or start a new chat</div>';
          return;
        }

        messagesContainer.innerHTML = currentChat.messages.map(message => `
          <div class="message ${message.role}">
            <div class="message-content">
              ${message.content}
              ${message.hasArtifact ? this.renderArtifactPreview(message.artifactId) : ''}
            </div>
            <div class="message-time">${this.formatDate(message.timestamp)}</div>
          </div>
        `).join('');

        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // Render artifact preview in message
      renderArtifactPreview(artifactId) {
        const artifact = this.data.artifacts.find(a => a.id === artifactId);
        if (!artifact) return '';

        return `
          <div class="artifact-preview" onclick="Loom4.viewArtifactInPanel(${artifactId})">
            <div class="artifact-preview-header">
              <i class="fas fa-code"></i>
              <span class="artifact-preview-title">${artifact.title}</span>
              <span class="artifact-preview-type">${artifact.type.toUpperCase()}</span>
            </div>
            <div class="artifact-preview-description">${artifact.preview}</div>
            <div class="artifact-preview-footer">
              <span>Click to view in artifact panel</span>
              <i class="fas fa-external-link-alt"></i>
            </div>
          </div>
        `;
      }

      // View artifact
      viewArtifact(id) {
        const artifact = this.data.artifacts.find(a => a.id === id);
        if (!artifact) return;

        // Update modal content
        document.getElementById('artifact-viewer-title').textContent = artifact.title;
        document.getElementById('artifact-viewer-meta').textContent = `${artifact.type.toUpperCase()} • ${artifact.size}`;

        // Create tabs based on type
        const tabsContainer = document.getElementById('artifact-tabs');
        const contentContainer = document.getElementById('artifact-content');

        if (artifact.type === 'html') {
          tabsContainer.innerHTML = `
            <button class="tab-btn active" data-tab="preview">Preview</button>
            <button class="tab-btn" data-tab="code">Code</button>
          `;
          contentContainer.innerHTML = `
            <div class="tab-content active" id="preview-tab">
              <iframe class="html-preview" srcdoc="${this.escapeHtml(artifact.content)}"></iframe>
            </div>
            <div class="tab-content" id="code-tab">
              <pre class="code-viewer"><code>${this.escapeHtml(artifact.content)}</code></pre>
            </div>
          `;
        } else {
          tabsContainer.innerHTML = `
            <button class="tab-btn active" data-tab="code">Code</button>
          `;
          contentContainer.innerHTML = `
            <div class="tab-content active" id="code-tab">
              <pre class="code-viewer"><code>${this.escapeHtml(artifact.content)}</code></pre>
            </div>
          `;
        }

        // Setup tab switching
        tabsContainer.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            
            // Update buttons
            tabsContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update content
            contentContainer.querySelectorAll('.tab-content').forEach(content => {
              content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`)?.classList.add('active');
          });
        });

        // Show modal
        this.showModal('artifact-viewer-modal');
      }

      // Show create project
      showCreateProject() {
        const projectName = prompt('Enter project name:', 'New Project');
        if (projectName && projectName.trim()) {
          const newProject = {
            id: Date.now(),
            title: projectName.trim(),
            description: 'A new project created with Loom4 AI assistant',
            status: 'Active',
            lastActive: new Date().toISOString().split('T')[0],
            createdAt: new Date().toISOString()
          };
          
          this.data.projects.unshift(newProject);
          this.renderProjects();
          this.showNotification(`Project "${projectName}" created successfully!`, 'success');
        }
      }

      // Show create artifact
      showCreateArtifact() {
        // Reset form
        document.getElementById('create-artifact-form').reset();
        this.showModal('create-artifact-modal');
      }

      // Show new chat
      showNewChat() {
        // Clear current chat and show welcome message
        this.currentChatId = null;
        this.renderCurrentChat();
        this.renderChatHistory();
        
        // Focus on input
        document.getElementById('chat-input').focus();
        
        // Show chat section
        if (this.currentSection !== 'chat') {
          this.showSection('chat');
        }
      }

      // Send message
      sendMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        
        if (!message) return;

        // If no current chat, create a new one
        if (!this.currentChatId) {
          this.createNewChat(message);
        }

        // Add user message
        this.addMessage('user', message);
        
        // Clear input
        input.value = '';
        document.getElementById('send-btn').disabled = true;
        
        // Show typing indicator and generate AI response
        this.showTypingIndicator();
        setTimeout(() => {
          this.generateAIResponse(message);
        }, 1000 + Math.random() * 2000); // Simulate thinking time
      }

      // Create new chat
      createNewChat(firstMessage) {
        const newChat = {
          id: Date.now(),
          title: this.generateChatTitle(firstMessage),
          messages: [],
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        this.data.chats.unshift(newChat);
        this.currentChatId = newChat.id;
        this.renderChatHistory();
      }

      // Generate chat title from first message
      generateChatTitle(message) {
        if (message.length <= 30) return message;
        return message.substring(0, 30) + '...';
      }

      // Add message to current chat
      addMessage(role, content, hasArtifact = false, artifactId = null) {
        const currentChat = this.data.chats.find(chat => chat.id === this.currentChatId);
        if (!currentChat) return;

        const newMessage = {
          id: Date.now(),
          role,
          content,
          timestamp: new Date().toISOString(),
          hasArtifact,
          artifactId
        };

        currentChat.messages.push(newMessage);
        currentChat.updatedAt = new Date().toISOString();
        
        this.renderCurrentChat();
        this.renderChatHistory();
      }

      // Show typing indicator
      showTypingIndicator() {
        const messagesContainer = document.getElementById('chat-messages');
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message assistant typing';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
          <div class="message-content">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        `;
        messagesContainer.appendChild(typingDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // Remove typing indicator
      removeTypingIndicator() {
        const typing = document.getElementById('typing-indicator');
        if (typing) typing.remove();
      }

      // Generate AI response
      generateAIResponse(userMessage) {
        this.removeTypingIndicator();
        
        const responses = this.getAIResponseTemplates();
        const response = this.selectResponse(userMessage, responses);
        
        // Check if response should generate an artifact
        if (response.shouldCreateArtifact) {
          const artifact = this.createArtifactFromMessage(userMessage, response.artifactType);
          this.addMessage('assistant', response.content, true, artifact.id);
          
          // Auto-show artifact panel if in chat section
          if (this.currentSection === 'chat') {
            setTimeout(() => {
              this.viewArtifactInPanel(artifact.id);
            }, 500);
          }
        } else {
          this.addMessage('assistant', response.content);
        }
      }

      // Get AI response templates
      getAIResponseTemplates() {
        return [
          {
            keywords: ['html', 'webpage', 'website', 'landing', 'page'],
            content: "I'll create a modern webpage for you with clean design and responsive layout.",
            shouldCreateArtifact: true,
            artifactType: 'html'
          },
          {
            keywords: ['css', 'style', 'design', 'layout', 'grid', 'flexbox'],
            content: "I'll create a CSS solution with modern styling and responsive design.",
            shouldCreateArtifact: true,
            artifactType: 'css'
          },
          {
            keywords: ['javascript', 'js', 'react', 'component', 'function', 'code'],
            content: "I'll write a JavaScript solution following best practices and modern syntax.",
            shouldCreateArtifact: true,
            artifactType: 'javascript'
          },
          {
            keywords: ['help', 'how', 'what', 'explain', 'tutorial'],
            content: "I'm here to help! I can assist with coding, design, analysis, writing, and many other tasks. What would you like to work on?",
            shouldCreateArtifact: false
          },
          {
            keywords: ['hello', 'hi', 'hey', 'good'],
            content: "Hello! I'm Loom4, your AI assistant. I can help you with web development, writing code, creating designs, and much more. What project can I help you with today?",
            shouldCreateArtifact: false
          }
        ];
      }

      // Select appropriate response
      selectResponse(message, responses) {
        const lowerMessage = message.toLowerCase();
        
        for (const response of responses) {
          if (response.keywords.some(keyword => lowerMessage.includes(keyword))) {
            return response;
          }
        }
        
        // Default response
        return {
          content: "That's an interesting question! I can help you with web development, coding, design, analysis, and creative projects. Could you provide more details about what you'd like to create or learn?",
          shouldCreateArtifact: false
        };
      }

      // Create artifact from message
      createArtifactFromMessage(userMessage, type) {
        const templates = {
          html: {
            title: "Generated Webpage",
            content: this.generateHTMLContent(userMessage),
            preview: "Modern responsive webpage with clean design"
          },
          css: {
            title: "CSS Styles",
            content: this.generateCSSContent(userMessage),
            preview: "Custom CSS styles with modern design patterns"
          },
          javascript: {
            title: "JavaScript Code",
            content: this.generateJSContent(userMessage),
            preview: "Clean JavaScript code following best practices"
          }
        };

        const template = templates[type] || templates.html;
        const newArtifact = {
          id: Date.now(),
          title: template.title,
          type,
          content: template.content,
          preview: template.preview,
          createdAt: new Date().toISOString(),
          size: this.calculateSize(template.content)
        };

        this.data.artifacts.unshift(newArtifact);
        this.renderArtifacts();
        this.renderArtifactList();
        
        return newArtifact;
      }

      // Generate HTML content based on user message
      generateHTMLContent(userMessage) {
        const templates = [
          `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Webpage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        .content {
            line-height: 1.8;
            font-size: 1.1rem;
            color: #555;
        }
        .cta {
            text-align: center;
            margin-top: 40px;
        }
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to Your Custom Page</h1>
            <p>This page was generated based on your request</p>
        </div>
        <div class="content">
            <p>This is a modern, responsive webpage created with clean HTML and CSS. It features a gradient background, centered content, and smooth animations.</p>
            <p>The design follows modern web standards and is fully responsive across all devices. You can customize the colors, typography, and layout to match your specific needs.</p>
        </div>
        <div class="cta">
            <button class="btn">Get Started</button>
        </div>
    </div>
</body>
</html>`
        ];
        
        return templates[0];
      }

      // Generate CSS content based on user message
      generateCSSContent(userMessage) {
        return `/* Modern CSS Grid Layout */
.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 1px solid #e5e7eb;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #667eea, #764ba2);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: #667eea;
}

.card:hover::before {
  transform: scaleX(1);
}

.card-header {
  margin-bottom: 16px;
}

.card-title {
  color: #1f2937;
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 8px;
}

.card-description {
  color: #6b7280;
  line-height: 1.6;
}

.card-footer {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid #f3f4f6;
}

.btn {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    grid-template-columns: 1fr;
    padding: 16px;
    gap: 16px;
  }
  
  .card {
    padding: 20px;
  }
  
  .card-title {
    font-size: 1.25rem;
  }
}`;
      }

      // Generate JavaScript content based on user message
      generateJSContent(userMessage) {
        return `// Modern JavaScript Component
class InteractiveComponent {
  constructor(element) {
    this.element = element;
    this.state = {
      isActive: false,
      count: 0,
      data: []
    };
    
    this.init();
  }

  // Initialize the component
  init() {
    this.setupEventListeners();
    this.render();
    console.log('Component initialized');
  }

  // Set up event listeners
  setupEventListeners() {
    const button = this.element.querySelector('.action-button');
    const toggleButton = this.element.querySelector('.toggle-button');
    
    if (button) {
      button.addEventListener('click', (e) => {
        this.handleAction(e);
      });
    }
    
    if (toggleButton) {
      toggleButton.addEventListener('click', () => {
        this.toggle();
      });
    }
  }

  // Handle action button click
  handleAction(event) {
    event.preventDefault();
    
    this.setState({
      count: this.state.count + 1
    });
    
    this.addDataItem({
      id: Date.now(),
      timestamp: new Date().toISOString(),
      action: 'button_clicked'
    });
    
    console.log('Action performed:', this.state);
  }

  // Toggle component state
  toggle() {
    this.setState({
      isActive: !this.state.isActive
    });
  }

  // Update component state
  setState(newState) {
    this.state = { ...this.state, ...newState };
    this.render();
    this.onStateChange();
  }

  // Add item to data array
  addDataItem(item) {
    this.setState({
      data: [...this.state.data, item]
    });
  }

  // Render component
  render() {
    const { isActive, count, data } = this.state;
    
    this.element.innerHTML = \`
      <div class="component \${isActive ? 'active' : ''}">
        <h3>Interactive Component</h3>
        <p>Status: \${isActive ? 'Active' : 'Inactive'}</p>
        <p>Count: \${count}</p>
        <p>Data items: \${data.length}</p>
        
        <div class="actions">
          <button class="action-button">Perform Action</button>
          <button class="toggle-button">
            \${isActive ? 'Deactivate' : 'Activate'}
          </button>
        </div>
        
        <div class="data-list">
          \${data.map(item => \`
            <div class="data-item">
              \${item.action} - \${new Date(item.timestamp).toLocaleTimeString()}
            </div>
          \`).join('')}
        </div>
      </div>
    \`;
    
    // Re-setup event listeners after render
    this.setupEventListeners();
  }

  // State change callback
  onStateChange() {
    console.log('State changed:', this.state);
    
    // Emit custom event
    const event = new CustomEvent('componentStateChange', {
      detail: { state: this.state }
    });
    this.element.dispatchEvent(event);
  }

  // Public method to get current state
  getState() {
    return { ...this.state };
  }

  // Public method to reset component
  reset() {
    this.setState({
      isActive: false,
      count: 0,
      data: []
    });
  }
}

// Usage example
document.addEventListener('DOMContentLoaded', () => {
  const componentElement = document.getElementById('interactive-component');
  
  if (componentElement) {
    const component = new InteractiveComponent(componentElement);
    
    // Listen for state changes
    componentElement.addEventListener('componentStateChange', (event) => {
      console.log('Component state updated:', event.detail.state);
    });
  }
});

// Export for module usage
export { InteractiveComponent };`;
      }

      // Save artifact
      saveArtifact() {
        const form = document.getElementById('create-artifact-form');
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const title = document.getElementById('artifact-title').value;
        const type = document.getElementById('artifact-type').value;
        const content = document.getElementById('artifact-content').value;
        const preview = document.getElementById('artifact-preview').value || 'Custom artifact';

        const newArtifact = {
          id: Date.now(),
          title,
          type,
          content,
          preview,
          createdAt: new Date().toISOString(),
          size: this.calculateSize(content)
        };

        this.data.artifacts.unshift(newArtifact);
        this.renderArtifacts();
        this.closeModal(document.getElementById('create-artifact-modal'));
        
        alert(`Artifact "${title}" created successfully!`);
      }

      // Show modal
      showModal(modalId) {
        document.getElementById(modalId).classList.add('active');
      }

      // Close modal
      closeModal(modal) {
        modal.classList.remove('active');
      }


      // Save application settings
      saveSettings() {
        const theme = document.getElementById('theme-select').value;
        const autoCollapse = document.getElementById('auto-collapse-sidebar').checked;
        const emailNotifications = document.getElementById('email-notifications').checked;
        const pushNotifications = document.getElementById('push-notifications').checked;
        const soundNotifications = document.getElementById('sound-notifications').checked;
        const analyticsOptOut = document.getElementById('analytics-opt-out').checked;
        const crashReports = document.getElementById('crash-reports').checked;
        
        const settings = {
          theme,
          autoCollapse,
          notifications: {
            email: emailNotifications,
            push: pushNotifications,
            sound: soundNotifications
          },
          privacy: {
            analyticsOptOut,
            crashReports
          }
        };
        
        // Apply theme immediately
        if (theme !== 'auto') {
          document.body.setAttribute('data-theme', theme);
        } else {
          document.body.removeAttribute('data-theme');
        }
        
        localStorage.setItem('loom4_settings', JSON.stringify(settings));
        
        this.closeModal(document.getElementById('settings-modal'));
        this.showNotification('Settings saved successfully!', 'success');
      }

      // Save language settings
      saveLanguage() {
        const language = document.getElementById('language-select').value;
        const region = document.getElementById('region-select').value;
        const dateFormat = document.getElementById('date-format-select').value;
        
        const languageSettings = {
          language,
          region,
          dateFormat
        };
        
        localStorage.setItem('loom4_language', JSON.stringify(languageSettings));
        
        this.closeModal(document.getElementById('language-modal'));
        this.showNotification('Language settings updated!', 'success');
      }

      // Handle logout
      handleLogout() {
        if (confirm('Are you sure you want to logout? Any unsaved changes will be lost.')) {
          // Clear user data
          localStorage.removeItem('loom4_user_profile');
          localStorage.removeItem('loom4_settings');
          localStorage.removeItem('loom4_language');
          
          // Reset UI
          
          this.showNotification('Successfully logged out!', 'info');
          
          // In real app, redirect to login page
          setTimeout(() => {
            this.showNotification('Redirecting to login...', 'info');
          }, 1000);
        }
      }

      // Show notification
      showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
          <div class="notification-icon">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'}"></i>
          </div>
          <div class="notification-content">${message}</div>
          <button class="notification-close">&times;</button>
        `;
        
        // Add to notification container or create one
        let container = document.querySelector('.notification-container');
        if (!container) {
          container = document.createElement('div');
          container.className = 'notification-container';
          document.body.appendChild(container);
        }
        
        container.appendChild(notification);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 5000);
        
        // Close button functionality
        notification.querySelector('.notification-close').addEventListener('click', () => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        });
      }

      // Render artifact list in sidebar
      renderArtifactList() {
        const list = document.getElementById('artifact-list');
        const emptyState = document.getElementById('artifact-empty-state');
        
        if (!list) return;

        if (this.data.artifacts.length === 0) {
          list.style.display = 'none';
          emptyState.style.display = 'block';
          return;
        }

        list.style.display = 'block';
        emptyState.style.display = 'none';

        list.innerHTML = this.data.artifacts.map(artifact => `
          <div class="artifact-item" onclick="Loom4.viewArtifactInPanel(${artifact.id})">
            <div class="artifact-item-header">
              <h4 class="artifact-item-title">${artifact.title}</h4>
              <span class="artifact-item-type">${artifact.type}</span>
            </div>
            <div class="artifact-item-description">${artifact.preview}</div>
            <div class="artifact-item-meta">
              <span>${this.formatDate(artifact.createdAt)}</span>
              <span>${artifact.size}</span>
            </div>
          </div>
        `).join('');
      }

      // Setup panel resizer
      setupPanelResizer() {
        const resizer = document.getElementById('panel-resizer');
        const artifactPanel = document.getElementById('artifact-panel');
        
        if (!resizer || !artifactPanel) return;
        
        let startX, startWidth;
        
        resizer.addEventListener('mousedown', (e) => {
          this.isResizing = true;
          startX = e.clientX;
          startWidth = parseInt(document.defaultView.getComputedStyle(artifactPanel).width, 10);
          
          resizer.classList.add('dragging');
          document.body.style.cursor = 'col-resize';
          document.body.style.userSelect = 'none';
          
          e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
          if (!this.isResizing) return;
          
          const width = startWidth - (e.clientX - startX);
          const minWidth = 300;
          const maxWidth = 800;
          
          if (width >= minWidth && width <= maxWidth) {
            artifactPanel.style.width = width + 'px';
            this.panelSizes.artifactPanel = width;
          }
        });
        
        document.addEventListener('mouseup', () => {
          if (this.isResizing) {
            this.isResizing = false;
            resizer.classList.remove('dragging');
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
            
            // Save panel size
            localStorage.setItem('loom4_panel_sizes', JSON.stringify(this.panelSizes));
          }
        });
      }

      // Show artifact panel
      showArtifactPanel() {
        const panel = document.getElementById('artifact-panel');
        const resizer = document.getElementById('panel-resizer');
        
        // Only show if we're in chat section
        if (this.currentSection === 'chat') {
          panel.classList.remove('hidden');
          panel.style.display = 'flex';
          resizer.style.display = 'block';
          
          // Restore saved width
          if (this.panelSizes.artifactPanel) {
            panel.style.width = this.panelSizes.artifactPanel + 'px';
          }
        }
        
        localStorage.setItem('loom4_artifact_panel_visible', 'true');
      }

      // Hide artifact panel
      hideArtifactPanel() {
        const panel = document.getElementById('artifact-panel');
        const resizer = document.getElementById('panel-resizer');
        
        panel.classList.add('hidden');
        panel.style.display = 'none';
        resizer.style.display = 'none';
        
        localStorage.setItem('loom4_artifact_panel_visible', 'false');
      }

      // Load panel settings
      loadPanelSettings() {
        // Load panel sizes
        const savedSizes = localStorage.getItem('loom4_panel_sizes');
        if (savedSizes) {
          this.panelSizes = { ...this.panelSizes, ...JSON.parse(savedSizes) };
        }
        
        
        // Initial setup - artifact panel only visible in chat section
        if (this.currentSection === 'chat') {
          // Load panel visibility
          const artifactPanelVisible = localStorage.getItem('loom4_artifact_panel_visible');
          if (artifactPanelVisible === 'false') {
            this.hideArtifactPanel();
          } else {
            this.showArtifactPanel();
          }
        } else {
          // Hide panels for non-chat sections
          const panel = document.getElementById('artifact-panel');
          const resizer = document.getElementById('panel-resizer');
          panel.style.display = 'none';
          resizer.style.display = 'none';
        }
      }


      // Profile menu methods
      toggleProfileMenu() {
        const trigger = document.getElementById('profile-menu-trigger');
        const overlay = document.getElementById('profile-menu-overlay');
        
        if (overlay.classList.contains('active')) {
          this.closeProfileMenu();
        } else {
          this.openProfileMenu();
        }
      }

      openProfileMenu() {
        const trigger = document.getElementById('profile-menu-trigger');
        const overlay = document.getElementById('profile-menu-overlay');
        
        trigger.classList.add('active');
        overlay.classList.add('active');
      }

      closeProfileMenu() {
        const trigger = document.getElementById('profile-menu-trigger');
        const overlay = document.getElementById('profile-menu-overlay');
        
        trigger.classList.remove('active');
        overlay.classList.remove('active');
      }

      handleProfileMenuAction(action) {
        this.closeProfileMenu();
        
        switch(action) {
          case 'settings':
            console.log('Opening settings...');
            break;
          case 'language':
            console.log('Opening language settings...');
            break;
          case 'help':
            console.log('Opening help...');
            break;
          case 'upgrade':
            console.log('Opening upgrade plan...');
            break;
          case 'learn':
            console.log('Opening learn more...');
            break;
          case 'logout':
            console.log('Logging out...');
            break;
          default:
            console.log('Unknown action:', action);
        }
      }

      // View artifact in panel (new method)
      viewArtifactInPanel(id) {
        const artifact = this.data.artifacts.find(a => a.id === id);
        if (!artifact) return;

        // Find the chat that contains this artifact
        const relatedChat = this.findChatWithArtifact(id);
        
        if (relatedChat) {
          // Switch to chat section without showing chat list, then load the related chat
          this.showChatSection();
          this.loadChat(relatedChat.id);
        }

        // Show and render the artifact in the artifact panel
        this.currentArtifact = artifact;
        this.showArtifactPanel();
        this.showArtifactViewer(artifact);
      }

      // Find chat that contains a specific artifact
      findChatWithArtifact(artifactId) {
        return this.data.chats.find(chat => 
          chat.messages.some(message => 
            message.hasArtifact && message.artifactId === artifactId
          )
        );
      }

      // Show artifact viewer in panel
      showArtifactViewer(artifact) {
        // Switch to viewer mode
        const defaultContent = document.getElementById('artifact-default-content');
        const viewerContent = document.getElementById('artifact-viewer-content');
        
        if (defaultContent && viewerContent) {
          defaultContent.style.display = 'none';
          viewerContent.style.display = 'flex';
        }

        // Create tabs and content based on artifact type
        this.renderArtifactViewer(artifact);
      }

      // Render artifact viewer content
      renderArtifactViewer(artifact) {
        const tabsContainer = document.getElementById('artifact-viewer-tabs');
        const bodyContainer = document.getElementById('artifact-viewer-body');

        // Add artifact header with title and back button
        const headerHtml = `
          <div class="artifact-viewer-header-info">
            <button class="btn btn-ghost" id="back-to-list-btn" title="Back to List">
              <i class="fas fa-arrow-left"></i>
            </button>
            <div class="artifact-info">
              <h3>${artifact.title}</h3>
              <div class="artifact-meta">
                <span class="artifact-type-badge">${artifact.type.toUpperCase()}</span>
                <span class="artifact-size">${artifact.size}</span>
                <span class="artifact-date">${this.formatDate(artifact.createdAt)}</span>
              </div>
            </div>
          </div>
        `;

        if (artifact.type === 'html') {
          // HTML artifacts get Preview and Code tabs
          tabsContainer.innerHTML = headerHtml + `
            <div class="artifact-tabs-row">
              <button class="artifact-tab active" data-tab="preview">Preview</button>
              <button class="artifact-tab" data-tab="code">Code</button>
            </div>
          `;
          
          bodyContainer.innerHTML = `
            <div class="artifact-tab-content active" id="preview-content">
              <iframe class="artifact-preview-frame" srcdoc="${this.escapeHtml(artifact.content)}"></iframe>
            </div>
            <div class="artifact-tab-content" id="code-content">
              <div class="artifact-code-viewer">${this.escapeHtml(artifact.content)}</div>
            </div>
          `;
        } else {
          // Other artifacts get only Code tab
          tabsContainer.innerHTML = headerHtml + `
            <div class="artifact-tabs-row">
              <button class="artifact-tab active" data-tab="code">Code</button>
            </div>
          `;
          
          bodyContainer.innerHTML = `
            <div class="artifact-tab-content active" id="code-content">
              <div class="artifact-code-viewer">${this.escapeHtml(artifact.content)}</div>
            </div>
          `;
        }

        // Re-attach event listeners for the new back button
        document.getElementById('back-to-list-btn')?.addEventListener('click', () => this.showArtifactList());

        // Setup tab switching
        tabsContainer.querySelectorAll('.artifact-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            const targetTab = tab.dataset.tab;
            
            // Update tab buttons
            tabsContainer.querySelectorAll('.artifact-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Update tab content
            bodyContainer.querySelectorAll('.artifact-tab-content').forEach(content => {
              content.classList.remove('active');
            });
            document.getElementById(`${targetTab}-content`)?.classList.add('active');
          });
        });
      }

      // Show artifact list (back button)
      showArtifactList() {
        const defaultContent = document.getElementById('artifact-default-content');
        const viewerContent = document.getElementById('artifact-viewer-content');
        
        if (defaultContent && viewerContent) {
          defaultContent.style.display = 'block';
          viewerContent.style.display = 'none';
        }
        
        this.currentArtifact = null;
      }

      // Edit current artifact
      editCurrentArtifact() {
        if (!this.currentArtifact) return;
        
        // Pre-fill the edit modal with current artifact data
        document.getElementById('artifact-title').value = this.currentArtifact.title;
        document.getElementById('artifact-type').value = this.currentArtifact.type;
        document.getElementById('artifact-content').value = this.currentArtifact.content;
        document.getElementById('artifact-preview').value = this.currentArtifact.preview;
        
        this.showModal('create-artifact-modal');
      }

      // Open chat with artifact (new method for artifact grid clicks)
      openChatWithArtifact(id) {
        // Switch to chat section first
        this.showSection('chat');
        
        // Then open the artifact in the panel
        setTimeout(() => {
          this.viewArtifactInPanel(id);
        }, 100); // Small delay to ensure chat section is loaded
      }

      // Override original viewArtifact to handle different contexts
      viewArtifact(id) {
        // If we're in the chat section, open in panel
        if (this.currentSection === 'chat') {
          this.viewArtifactInPanel(id);
          return;
        }
        
        // If we're in artifacts section (grid view), switch to chat with artifact
        if (this.currentSection === 'artifacts') {
          this.openChatWithArtifact(id);
          return;
        }
        
        // Otherwise, open in modal (fallback)
        const artifact = this.data.artifacts.find(a => a.id === id);
        if (!artifact) return;

        // Update modal content
        document.getElementById('artifact-viewer-title').textContent = artifact.title;
        document.getElementById('artifact-viewer-meta').textContent = `${artifact.type.toUpperCase()} • ${artifact.size}`;

        // Create tabs based on type (existing modal code)
        const tabsContainer = document.getElementById('artifact-tabs');
        const contentContainer = document.getElementById('artifact-content');

        if (artifact.type === 'html') {
          tabsContainer.innerHTML = `
            <button class="tab-btn active" data-tab="preview">Preview</button>
            <button class="tab-btn" data-tab="code">Code</button>
          `;
          contentContainer.innerHTML = `
            <div class="tab-content active" id="preview-tab">
              <iframe class="html-preview" srcdoc="${this.escapeHtml(artifact.content)}"></iframe>
            </div>
            <div class="tab-content" id="code-tab">
              <pre class="code-viewer"><code>${this.escapeHtml(artifact.content)}</code></pre>
            </div>
          `;
        } else {
          tabsContainer.innerHTML = `
            <button class="tab-btn active" data-tab="code">Code</button>
          `;
          contentContainer.innerHTML = `
            <div class="tab-content active" id="code-tab">
              <pre class="code-viewer"><code>${this.escapeHtml(artifact.content)}</code></pre>
            </div>
          `;
        }

        // Setup tab switching for modal
        tabsContainer.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            
            // Update buttons
            tabsContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update content
            contentContainer.querySelectorAll('.tab-content').forEach(content => {
              content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`)?.classList.add('active');
          });
        });

        // Show modal
        this.showModal('artifact-viewer-modal');
      }

      // Utility functions
      formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;
        return date.toLocaleDateString();
      }

      calculateSize(content) {
        const bytes = new Blob([content]).size;
        if (bytes < 1024) return `${bytes} B`;
        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
        return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
      }

      escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
    }

    // Initialize the application
    const Loom4 = new Loom4App();

    // Make some methods globally accessible for inline handlers
    window.Loom4 = Loom4;
  </script>
</body>
</html>