<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta tags for character encoding and responsive design -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loom4 - AI Assistant</title>
  
  <!-- External CSS libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Base styles -->
  <link rel="stylesheet" href="styles.css">
  
</head>

<body>
  <!-- Main application container - houses sidebar and main content -->
  <div class="app-container">
    
    <!-- LEFT SIDEBAR - Navigation and chat history -->
    <div class="sidebar" id="sidebar">
      
      <!-- Sidebar header with logo and toggle button -->
      <div class="sidebar-header">
        <div class="header-content">
          <!-- Toggle button to collapse/expand sidebar -->
          <div class="sidebar-toggle" id="sidebarToggle">
            <i class="fa-brands fa-flipboard"></i>
          </div>
          <!-- Application logo -->
          <div class="app-logo">
            <h1>Loom4</h1>
          </div>
        </div>
      </div>

      <!-- Navigation menu -->
      <nav class="sidebar-nav">
        <!-- Main navigation items -->
        <div class="nav-item active" data-section="projects">
          <i class="fas fa-folder"></i>
          <span>Projects</span>
        </div>

        <div class="nav-item" data-section="connect">
          <i class="fas fa-plug"></i>
          <span>Connect</span>
        </div>

        <div class="nav-item" data-section="artifacts">
          <i class="fas fa-cube"></i>
          <span>Artifacts</span>
        </div>

        <div class="nav-item" data-section="chat">
          <i class="fas fa-comments"></i>
          <span>Chat</span>
        </div>


        <!-- User profile section at bottom of sidebar -->
        <div class="profile-section">
          <!-- Profile toggle button -->
          <div class="nav-item profile-item" id="profileToggle">
            <i class="fas fa-user-circle"></i>
            <span>My Profile</span>
          </div>
        </div>
      </nav>
    </div>

    <!-- MAIN CONTENT AREA - Different sections shown based on navigation -->
    <div class="main-content">
      
      <!-- PROJECTS SECTION - Manage AI projects -->
      <div class="content-section active" id="projects-section">
        <div class="section-container">
          <div class="section-header">
            <h2>Projects</h2>
            <!-- Button to create new project -->
            <button class="add-btn" id="addProjectBtn">
              <i class="fas fa-plus"></i>
              Add Project
            </button>
          </div>
          <!-- Grid layout for project cards -->
          <div class="projects-grid" id="projectsGrid">
            <!-- Projects will be populated here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- CONNECT SECTION - Knowledge base connections -->
      <div class="content-section" id="connect-section">
        <div class="connect-container">
          <!-- Section header -->
          <div class="connect-header">
            <h1>Knowledge Base</h1>
            <p>Connect your data sources to enhance AI conversations</p>
          </div>

          <!-- Grid of connection options -->
          <div class="connect-grid">
            
            <!-- File upload connection card -->
            <div class="connect-card" data-connection-type="file">
              <div class="connect-card-header">
                <div class="connect-icon file-icon">
                  <i class="fas fa-file-upload"></i>
                </div>
                <h3>Files</h3>
              </div>
              <p>Upload documents, PDFs, and other files</p>
              <button class="connect-btn">Connect Files</button>
            </div>

            <!-- Web content connection card -->
            <div class="connect-card" data-connection-type="web">
              <div class="connect-card-header">
                <div class="connect-icon url-icon">
                  <i class="fas fa-globe"></i>
                </div>
                <h3>Web Content</h3>
              </div>
              <p>Connect to websites and online resources</p>
              <button class="connect-btn">Connect Website</button>
            </div>

            <!-- Database connection card -->
            <div class="connect-card" data-connection-type="database">
              <div class="connect-card-header">
                <div class="connect-icon database-icon">
                  <i class="fas fa-database"></i>
                </div>
                <h3>Database</h3>
              </div>
              <p>Connect to your SQL or NoSQL databases</p>
              <button class="connect-btn">Connect Database</button>
            </div>

            <!-- API connection card -->
            <div class="connect-card" data-connection-type="api">
              <div class="connect-card-header">
                <div class="connect-icon api-icon">
                  <i class="fa-solid fa-plug"></i>
                  <div class="api-pulse"></div>
                </div>
                <h3>API</h3>
              </div>
              <p>Connect to REST or GraphQL APIs</p>
              <!-- API type badges -->
              <div class="api-badges">
                <span class="api-badge rest">REST</span>
                <span class="api-badge graphql">GraphQL</span>
                <span class="api-badge websocket">WS</span>
              </div>
              <button class="connect-btn">Configure API</button>
            </div>
          </div>

          <!-- Overview of connected knowledge sources -->
          <div class="knowledge-overview">
            <div class="overview-header">
              <h2>Connected Knowledge Sources</h2>
              <!-- Statistics display -->
              <div class="overview-stats">
                <div class="stat-item">
                  <span class="stat-number" id="totalFiles">0</span>
                  <span class="stat-label">Files</span>
                </div>
                <div class="stat-item">
                  <span class="stat-number" id="totalUrls">0</span>
                  <span class="stat-label">URLs</span>
                </div>
                <div class="stat-item">
                  <span class="stat-number" id="totalConnections">0</span>
                  <span class="stat-label">DB</span>
                </div>
                <div class="stat-item">
                  <span class="stat-number" id="totalConnections">0</span>
                  <span class="stat-label">API</span>
                </div>
              </div>
            </div>
            <!-- List of connected knowledge sources -->
            <div class="knowledge-list" id="knowledgeList">
              <!-- Knowledge sources will be listed here -->
            </div>
          </div>
        </div>
      </div>

      <!-- ARTIFACTS SECTION - View generated artifacts -->
      <div class="content-section" id="artifacts-section">
        <div class="artifacts-container">
          <div class="section-header">
            <h2>Your Artifacts</h2>
            <div class="artifact-controls">
              <button class="btn btn-secondary" id="createArtifactBtn">
                <i class="fas fa-plus"></i>
                Create Artifact
              </button>
            </div>
          </div>
          <!-- Grid of artifact cards -->
          <div class="artifacts-grid" id="artifactsGrid">
            <!-- Artifacts will be populated here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- CHAT SECTION - Chat history overview -->
      <div class="content-section" id="chat-section">
        <div class="chat-history-container">
          <div class="chat-history-header">
            <h1>Your chat history</h1>
            <!-- Button to start new chat -->
            <button class="new-chat-btn" id="addChatBtn">
              <i class="fas fa-plus"></i>
              New chat
            </button>
          </div>
          <!-- Search functionality for chats -->
          <div class="chat-search-container">
            <div class="chat-search">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Search your chats..." id="chatSearchInput">
            </div>
          </div>
          <!-- List of chat history items -->
          <div class="chat-history-list" id="chatHistoryList">
            <!-- Chat history will be populated here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- ACTIVE CHAT VIEW - Main chat interface -->
      <div class="content-section" id="active-chat-section">
        <!-- Chat header with model selector and artifact button -->
        <div class="chat-header">
          <h2>Chat with Loom4</h2>
          <!-- Enhanced artifact controls -->
          <div class="chat-header-controls">
            <button class="last-artifact-btn" id="lastArtifactBtn" title="Open last artifact">
              <i class="fas fa-cube"></i>
              <span class="btn-text">Last Artifact</span>
            </button>
            <button class="artifact-panel-toggle" id="artifactPanelToggle" title="Toggle artifact panel">
              <i class="fas fa-sidebar"></i>
            </button>
          </div>
        </div>

        <!-- Chat messages area -->
        <div class="chat-messages" id="chatMessages">
          <!-- Welcome message shown initially -->
          <div class="welcome-message">
            <div class="welcome-content">
              <h1>Hello, I'm Loom4</h1>
              <p>I'm an AI assistant that can help you with analysis, writing, coding, math, and many other tasks.</p>
              <div class="welcome-actions">
                <button class="btn btn-primary" onclick="document.getElementById('messageInput').focus()">
                  <i class="fas fa-comment"></i>
                  Start Chatting
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('artifactPanelToggle').click()">
                  <i class="fas fa-cube"></i>
                  View Artifacts
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Chat input area -->
        <div class="chat-input-container">
          <div class="chat-input">
            <textarea id="messageInput" placeholder="How can I help you today?"></textarea>
            <div class="input-actions">
              <button id="createArtifactFromChatBtn" class="input-action-btn" title="Create artifact">
                <i class="fas fa-plus-square"></i>
              </button>
              <button id="sendButton" class="send-btn" disabled>
                <i class="fas fa-arrow-up"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- PROFILE OVERLAY MENU -->
  <div class="profile-overlay" id="profileOverlay">
    <div class="profile-overlay-content">
      <div class="profile-overlay-header">
        <h3>Loom4 AI Assistant</h3>
        <p>john.doe@example.com</p>
      </div>
      <div class="profile-menu">
        <div class="profile-menu-item">
          <span>Settings</span>
        </div>
        <div class="profile-menu-item">
          <span>Help</span>
        </div>
        <div class="profile-menu-divider"></div>
        <div class="profile-menu-item logout">
          <span>Log out</span>
        </div>
      </div>
    </div>
  </div>



  <!-- CREATE ARTIFACT MODAL -->
  <div class="modal" id="createArtifactModal">
    <div class="modal-backdrop"></div>
    <div class="modal-container">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create New Artifact</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <form id="createArtifactForm">
            <div class="form-group">
              <label for="artifactTitle">Title *</label>
              <input type="text" id="artifactTitle" required placeholder="Enter artifact title">
            </div>
            
            <div class="form-group">
              <label for="artifactType">Type *</label>
              <select id="artifactType" required>
                <option value="">Select type</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="javascript">JavaScript</option>
                <option value="markdown">Markdown</option>
                <option value="text">Plain Text</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="artifactContent">Content *</label>
              <textarea id="artifactContent" required rows="10" placeholder="Enter artifact content"></textarea>
            </div>
            
            <div class="form-group">
              <label for="artifactPreview">Preview Description</label>
              <textarea id="artifactPreview" rows="3" placeholder="Brief description of the artifact"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary modal-close">Cancel</button>
          <button class="btn btn-primary" id="saveArtifactBtn">Create Artifact</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Load the enhanced modular application -->
  <script type="module">
    // Import and initialize the enhanced app
    // import app from './src/core/app.js'; // Temporarily disabled to prevent conflicts
    
    // Initialize enhanced features after app loads
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, initializing...');
      
      // Setup basic navigation first
      setupBasicNavigation();
      
      // Setup enhanced artifact controls
      setupEnhancedArtifactControls();
      
      // Setup create artifact modal
      setupCreateArtifactModal();
      
      // Load sample data immediately and persistently
      loadFallbackData();
      
      // Also load after a delay to ensure it persists
      setTimeout(loadFallbackData, 1000);
      
      // Monitor and reload if data gets cleared
      setInterval(() => {
        const projectsGrid = document.getElementById('projectsGrid');
        const artifactsGrid = document.getElementById('artifactsGrid');
        const chatHistoryList = document.getElementById('chatHistoryList');
        
        if ((projectsGrid && projectsGrid.children.length === 0) ||
            (artifactsGrid && artifactsGrid.children.length === 0) ||
            (chatHistoryList && chatHistoryList.children.length === 0)) {
          console.log('Sample data missing, reloading...');
          loadFallbackData();
        }
      }, 2000);
    });

    function setupBasicNavigation() {
      console.log('Setting up basic navigation...');
      
      // Handle navigation clicks
      const navItems = document.querySelectorAll('.nav-item[data-section]');
      navItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const section = item.dataset.section;
          console.log('Navigating to:', section);
          showSection(section);
          
          // Update active nav item
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
        });
      });

      // Handle Add Project button
      const addProjectBtn = document.getElementById('addProjectBtn');
      if (addProjectBtn) {
        addProjectBtn.addEventListener('click', () => {
          alert('Add Project functionality would open a modal here.\n\nIn the full version, this would allow you to create new AI projects.');
        });
      }

      // Handle New Chat button
      const addChatBtn = document.getElementById('addChatBtn');
      if (addChatBtn) {
        addChatBtn.addEventListener('click', () => {
          alert('New Chat functionality would create a new chat session.\n\nIn the full version, this would start a new conversation with the AI.');
        });
      }

      // Handle Send button
      const sendButton = document.getElementById('sendButton');
      const messageInput = document.getElementById('messageInput');
      if (sendButton && messageInput) {
        sendButton.addEventListener('click', () => {
          const message = messageInput.value.trim();
          if (message) {
            alert(`Demo: Your message "${message}" would be sent to the AI.\n\nIn the full version, this would start an AI conversation.`);
            messageInput.value = '';
          }
        });

        // Enable/disable send button based on input
        messageInput.addEventListener('input', () => {
          sendButton.disabled = !messageInput.value.trim();
        });
      }
    }

    function showSection(sectionName) {
      console.log('Showing section:', sectionName);
      
      // Hide all sections
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(section => {
        section.classList.remove('active');
      });

      // Show target section
      const targetSection = document.querySelector(`#${sectionName}-section`);
      if (targetSection) {
        targetSection.classList.add('active');
        console.log('Section shown:', sectionName);
      } else {
        console.error('Section not found:', sectionName);
      }
    }

    function loadFallbackData() {
      console.log('Loading fallback sample data...');
      
      // Load sample projects
      const projectsGrid = document.getElementById('projectsGrid');
      if (projectsGrid && projectsGrid.children.length === 0) {
        console.log('Loading sample projects...');
        projectsGrid.innerHTML = `
          <div class="project-card" data-project-id="1">
            <div class="project-header">
              <h3>Website Redesign</h3>
              <span class="project-status active">Active</span>
            </div>
            <p class="project-description">Complete redesign of company website with modern UI/UX</p>
            <div class="project-meta">
              <span class="project-date">Last active: 2023-05-15</span>
              <span class="project-kb">web-design-kb</span>
            </div>
          </div>
          <div class="project-card" data-project-id="2">
            <div class="project-header">
              <h3>Mobile App Development</h3>
              <span class="project-status active">Active</span>
            </div>
            <p class="project-description">Building a cross-platform mobile app for iOS and Android</p>
            <div class="project-meta">
              <span class="project-date">Last active: 2023-05-10</span>
              <span class="project-kb">mobile-dev-kb</span>
            </div>
          </div>
          <div class="project-card" data-project-id="3">
            <div class="project-header">
              <h3>Marketing Campaign</h3>
              <span class="project-status planned">Planned</span>
            </div>
            <p class="project-description">Q3 marketing campaign for new product launch</p>
            <div class="project-meta">
              <span class="project-date">Not started</span>
              <span class="project-kb">marketing-kb</span>
            </div>
          </div>
        `;
      }

      // Load sample artifacts
      const artifactsGrid = document.getElementById('artifactsGrid');
      if (artifactsGrid && artifactsGrid.children.length === 0) {
        console.log('Loading sample artifacts...');
        artifactsGrid.innerHTML = `
          <div class="artifact-card" data-artifact-id="1">
            <div class="artifact-card-header">
              <div class="artifact-card-title">Homepage HTML</div>
              <div class="artifact-card-type">HTML</div>
            </div>
            <div class="artifact-card-preview">Modern homepage with gradient design and glass morphism effects</div>
            <div class="artifact-card-meta">
              <span class="artifact-date">Today</span>
              <span class="artifact-size">2.8 KB</span>
            </div>
          </div>
          <div class="artifact-card" data-artifact-id="2">
            <div class="artifact-card-header">
              <div class="artifact-card-title">Responsive CSS Grid</div>
              <div class="artifact-card-type">CSS</div>
            </div>
            <div class="artifact-card-preview">Responsive CSS grid layout with hover effects and mobile optimization</div>
            <div class="artifact-card-meta">
              <span class="artifact-date">1 hour ago</span>
              <span class="artifact-size">2.1 KB</span>
            </div>
          </div>
          <div class="artifact-card" data-artifact-id="3">
            <div class="artifact-card-header">
              <div class="artifact-card-title">React Dashboard Component</div>
              <div class="artifact-card-type">JAVASCRIPT</div>
            </div>
            <div class="artifact-card-preview">Complete React dashboard component with charts, loading states, and error handling</div>
            <div class="artifact-card-meta">
              <span class="artifact-date">2 hours ago</span>
              <span class="artifact-size">4.1 KB</span>
            </div>
          </div>
        `;
      }

      // Load sample chat history
      const chatHistoryList = document.getElementById('chatHistoryList');
      if (chatHistoryList && chatHistoryList.children.length === 0) {
        console.log('Loading sample chats...');
        chatHistoryList.innerHTML = `
          <div class="chat-history-item" data-chat-id="1">
            <div class="chat-preview">
              <h4>Website content ideas</h4>
              <p>Can you suggest some content for our homepage?</p>
              <span class="chat-time">1 minute ago</span>
            </div>
          </div>
          <div class="chat-history-item" data-chat-id="2">
            <div class="chat-preview">
              <h4>Code review help</h4>
              <p>I need help reviewing this React component</p>
              <span class="chat-time">1 hour ago</span>
            </div>
          </div>
          <div class="chat-history-item" data-chat-id="3">
            <div class="chat-preview">
              <h4>Meeting notes summary</h4>
              <p>Summary of yesterday's strategy meeting</p>
              <span class="chat-time">1 day ago</span>
            </div>
          </div>
        `;
      }

      // Add click handlers for artifact cards (using event delegation)
      const artifactsGrid = document.getElementById('artifactsGrid');
      if (artifactsGrid) {
        artifactsGrid.addEventListener('click', (e) => {
          const artifactCard = e.target.closest('.artifact-card');
          if (artifactCard) {
            const artifactId = artifactCard.dataset.artifactId;
            console.log('Artifact clicked:', artifactId);
            showArtifactDemo(artifactId);
          }
        });
      }

      // Add click handlers for project cards
      const projectsGrid = document.getElementById('projectsGrid');
      if (projectsGrid) {
        projectsGrid.addEventListener('click', (e) => {
          const projectCard = e.target.closest('.project-card');
          if (projectCard) {
            const projectId = projectCard.dataset.projectId;
            console.log('Project clicked:', projectId);
            showProjectDemo(projectId);
          }
        });
      }

      // Add click handlers for chat items
      const chatHistoryList = document.getElementById('chatHistoryList');
      if (chatHistoryList) {
        chatHistoryList.addEventListener('click', (e) => {
          const chatItem = e.target.closest('.chat-history-item');
          if (chatItem) {
            const chatId = chatItem.dataset.chatId;
            console.log('Chat clicked:', chatId);
            showChatDemo(chatId);
          }
        });
      }

      console.log('Fallback data loaded');
    }

    function showArtifactDemo(artifactId) {
      // Check for custom artifacts first
      if (window.customArtifacts && window.customArtifacts[artifactId]) {
        const artifact = window.customArtifacts[artifactId];
        openArtifactModal(artifact);
        return;
      }
      
      const artifacts = {
        '1': { 
          title: 'Homepage HTML', 
          type: 'html',
          content: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Awesome Website</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .header { 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 40px; 
            border-radius: 20px; 
            text-align: center;
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .content { 
            background: rgba(255,255,255,0.95);
            color: #333;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome to My Website</h1>
            <p>This is a beautiful homepage created with AI assistance</p>
        </div>
        <div class="content">
            <h2>About Our Company</h2>
            <p>We are a modern company focused on innovative solutions that help businesses grow and succeed in today's digital landscape.</p>
        </div>
    </div>
</body>
</html>`
        },
        '2': { 
          title: 'Responsive CSS Grid', 
          type: 'css',
          content: `.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
  background: #f8fafc;
  min-height: 100vh;
}

.grid-item {
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  border: 1px solid #e2e8f0;
  position: relative;
  overflow: hidden;
}

.grid-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
}

.grid-item:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: #667eea;
}

@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: 1fr;
    padding: 16px;
    gap: 16px;
  }
  
  .grid-item {
    padding: 20px;
  }
}`
        },
        '3': { 
          title: 'React Dashboard Component', 
          type: 'javascript',
          content: `import React, { useState, useEffect } from 'react';

const UserDashboard = ({ userId }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUser = async () => {
      try {
        setLoading(true);
        const response = await fetch(\`/api/users/\${userId}\`);
        
        if (!response.ok) {
          throw new Error('Failed to fetch user data');
        }
        
        const userData = await response.json();
        setUser(userData);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    if (userId) {
      fetchUser();
    }
  }, [userId]);

  if (loading) {
    return <div className="loading">Loading user data...</div>;
  }

  if (error) {
    return <div className="error">Error: {error}</div>;
  }

  if (!user) {
    return <div className="no-data">No user data found</div>;
  }

  return (
    <div className="user-dashboard">
      <header className="dashboard-header">
        <h1>Welcome, {user.name}!</h1>
        <p>{user.email}</p>
      </header>
      
      <div className="dashboard-content">
        <div className="stats-grid">
          <div className="stat-card">
            <h3>Projects</h3>
            <p>{user.projectCount || 0}</p>
          </div>
          <div className="stat-card">
            <h3>Tasks</h3>
            <p>{user.taskCount || 0}</p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default UserDashboard;`
        }
      };

      const artifact = artifacts[artifactId];
      if (artifact) {
        openArtifactModal(artifact);
      }
    }

    function openArtifactModal(artifact) {
      // Create modal overlay
      const modal = document.createElement('div');
      modal.className = 'artifact-modal-overlay';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      `;

      // Create modal content
      const modalContent = document.createElement('div');
      modalContent.className = 'artifact-modal-content';
      modalContent.style.cssText = `
        background: white;
        border-radius: 12px;
        max-width: 90vw;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      `;

      // Create header
      const header = document.createElement('div');
      header.style.cssText = `
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9fafb;
      `;
      header.innerHTML = `
        <div>
          <h3 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #111827;">${artifact.title}</h3>
          <p style="margin: 4px 0 0 0; font-size: 0.875rem; color: #6b7280; text-transform: uppercase; font-weight: 500;">${artifact.type}</p>
        </div>
        <button class="close-btn" style="
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #6b7280;
          padding: 4px;
          border-radius: 4px;
        ">&times;</button>
      `;

      // Create content area
      const contentArea = document.createElement('div');
      contentArea.style.cssText = `
        flex: 1;
        overflow: auto;
        padding: 24px;
      `;

      if (artifact.type === 'html') {
        // For HTML, show both preview and code
        contentArea.innerHTML = `
          <div style="margin-bottom: 20px;">
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button class="tab-btn active" data-tab="preview" style="
                padding: 8px 16px;
                border: 1px solid #d1d5db;
                background: #3b82f6;
                color: white;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
              ">Preview</button>
              <button class="tab-btn" data-tab="code" style="
                padding: 8px 16px;
                border: 1px solid #d1d5db;
                background: white;
                color: #374151;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
              ">Code</button>
            </div>
            <div class="tab-content preview-tab" style="display: block;">
              <iframe style="width: 100%; height: 400px; border: 1px solid #e5e7eb; border-radius: 8px;" srcdoc="${artifact.content.replace(/"/g, '&quot;')}"></iframe>
            </div>
            <div class="tab-content code-tab" style="display: none;">
              <pre style="
                background: #f3f4f6;
                padding: 16px;
                border-radius: 8px;
                overflow-x: auto;
                font-family: 'Monaco', 'Courier New', monospace;
                font-size: 13px;
                line-height: 1.5;
                margin: 0;
              "><code>${artifact.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
            </div>
          </div>
        `;
      } else {
        // For CSS and JS, show just the code
        contentArea.innerHTML = `
          <pre style="
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 0;
            max-height: 500px;
            overflow-y: auto;
          "><code>${artifact.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
        `;
      }

      // Assemble modal
      modalContent.appendChild(header);
      modalContent.appendChild(contentArea);
      modal.appendChild(modalContent);
      document.body.appendChild(modal);

      // Add event listeners
      const closeBtn = header.querySelector('.close-btn');
      closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
      });

      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });

      // Tab switching for HTML artifacts
      const tabBtns = contentArea.querySelectorAll('.tab-btn');
      const tabContents = contentArea.querySelectorAll('.tab-content');
      
      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.dataset.tab;
          
          // Update buttons
          tabBtns.forEach(b => {
            b.classList.remove('active');
            b.style.background = 'white';
            b.style.color = '#374151';
          });
          btn.classList.add('active');
          btn.style.background = '#3b82f6';
          btn.style.color = 'white';
          
          // Update content
          tabContents.forEach(content => {
            content.style.display = 'none';
          });
          const targetContent = contentArea.querySelector(`.${tab}-tab`);
          if (targetContent) {
            targetContent.style.display = 'block';
          }
        });
      });
    }

    function showProjectDemo(projectId) {
      const projects = {
        '1': { title: 'Website Redesign', description: 'Complete redesign of company website with modern UI/UX' },
        '2': { title: 'Mobile App Development', description: 'Building a cross-platform mobile app for iOS and Android' },
        '3': { title: 'Marketing Campaign', description: 'Q3 marketing campaign for new product launch' }
      };

      const project = projects[projectId];
      if (project) {
        alert(`Project: ${project.title}\n\n${project.description}\n\nIn the full version, this would open the project workspace with AI tools, knowledge base, and collaboration features.`);
      }
    }

    function showChatDemo(chatId) {
      const chats = {
        '1': { title: 'Website content ideas', lastMessage: 'Can you suggest some content for our homepage?' },
        '2': { title: 'Code review help', lastMessage: 'I need help reviewing this React component' },
        '3': { title: 'Meeting notes summary', lastMessage: 'Summary of yesterday\'s strategy meeting' }
      };

      const chat = chats[chatId];
      if (chat) {
        // Switch to active chat view
        showSection('active-chat');
        alert(`Opening chat: ${chat.title}\n\nLast message: ${chat.lastMessage}\n\nIn the full version, this would load the complete chat history and allow you to continue the conversation.`);
      }
    }

    function setupEnhancedArtifactControls() {
      // Artifact panel toggle
      const artifactPanelToggle = document.getElementById('artifactPanelToggle');
      if (artifactPanelToggle) {
        artifactPanelToggle.addEventListener('click', () => {
          alert('Artifact panel would toggle here.\n\nIn the full version, this opens the resizable artifact sidebar.');
        });
      }

      // Create artifact from chat
      const createFromChatBtn = document.getElementById('createArtifactFromChatBtn');
      if (createFromChatBtn) {
        createFromChatBtn.addEventListener('click', () => {
          const modal = document.getElementById('createArtifactModal');
          modal.style.display = 'flex';
        });
      }

      // Create artifact button
      const createArtifactBtn = document.getElementById('createArtifactBtn');
      if (createArtifactBtn) {
        createArtifactBtn.addEventListener('click', () => {
          const modal = document.getElementById('createArtifactModal');
          modal.style.display = 'flex';
        });
      }
    }

    function setupCreateArtifactModal() {
      const modal = document.getElementById('createArtifactModal');
      const saveBtn = document.getElementById('saveArtifactBtn');
      const form = document.getElementById('createArtifactForm');

      // Close modal handlers
      modal.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', () => {
          modal.style.display = 'none';
          form.reset();
        });
      });

      // Save artifact
      saveBtn.addEventListener('click', () => {
        if (form.checkValidity()) {
          const title = document.getElementById('artifactTitle').value;
          const type = document.getElementById('artifactType').value;
          const content = document.getElementById('artifactContent').value;
          const preview = document.getElementById('artifactPreview').value || 'Custom artifact';
          
          // Create new artifact and add to grid
          const artifactsGrid = document.getElementById('artifactsGrid');
          if (artifactsGrid) {
            const newArtifactId = Date.now().toString();
            const newArtifactCard = document.createElement('div');
            newArtifactCard.className = 'artifact-card';
            newArtifactCard.dataset.artifactId = newArtifactId;
            newArtifactCard.innerHTML = `
              <div class="artifact-card-header">
                <div class="artifact-card-title">${title}</div>
                <div class="artifact-card-type">${type.toUpperCase()}</div>
              </div>
              <div class="artifact-card-preview">${preview}</div>
              <div class="artifact-card-meta">
                <span class="artifact-date">Just now</span>
                <span class="artifact-size">Custom</span>
              </div>
            `;
            
            // Add to the beginning of the grid
            artifactsGrid.insertBefore(newArtifactCard, artifactsGrid.firstChild);
            
            // Store the artifact data for later viewing
            window.customArtifacts = window.customArtifacts || {};
            window.customArtifacts[newArtifactId] = { title, type, content, preview };
          }
          
          modal.style.display = 'none';
          form.reset();
          alert(`Artifact "${title}" created successfully!`);
        } else {
          form.reportValidity();
        }
      });

      // Modal backdrop click to close
      modal.querySelector('.modal-backdrop').addEventListener('click', () => {
        modal.style.display = 'none';
        form.reset();
      });
    }
  </script>
</body>

</html>